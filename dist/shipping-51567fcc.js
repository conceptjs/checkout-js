(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[16],{1546:function(e,t,n){"use strict";var a=n(1),i=n(40),s=n.n(i),r=n(0),o=n.n(r),c=n(450),d=n(448),l=Object(r.forwardRef)((function(e,t){var n=e.additionalClassName,i=e.label,r=e.id,l=Object(a.__rest)(e,["additionalClassName","label","id"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(c.a,Object(a.__assign)({},l,{className:s()("form-checkbox","optimizedCheckout-form-checkbox",n),id:r,ref:t,type:"checkbox"})),o.a.createElement(d.a,{htmlFor:r},i))}));t.a=l},1548:function(e,t,n){"use strict";var a=n(1),i=n(40),s=n.n(i),r=n(0),o=n.n(r),c=n(450),d=n(448),l=Object(r.forwardRef)((function(e,t){var n=e.additionalClassName,i=e.label,r=e.value,l=e.checked,u=e.id,p=Object(a.__rest)(e,["additionalClassName","label","value","checked","id"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(c.a,Object(a.__assign)({},p,{checked:l,className:s()("form-radio","optimizedCheckout-form-radio",n),id:u,ref:t,type:"radio",value:r})),o.a.createElement(d.a,{htmlFor:u},i))}));t.a=l},1553:function(e,t,n){"use strict";var a=n(13),i=n(0),s=Object(i.createContext)({onToggle:a.noop});t.a=s},1556:function(e,t,n){},1557:function(e,t,n){"use strict";var a=n(1),i=n(40),s=n.n(i),r=n(0),o=n.n(r),c=Object(r.forwardRef)((function(e,t){var n=e.additionalClassName,i=e.testId,r=e.className,c=Object(a.__rest)(e,["additionalClassName","testId","className"]);return o.a.createElement("textarea",Object(a.__assign)({},c,{className:r||s()("form-input","optimizedCheckout-form-input",n),"data-test":i,ref:t}))}));t.a=c},1564:function(e,t,n){},1575:function(e,t,n){},1578:function(e,t,n){},1579:function(e,t,n){},1580:function(e,t,n){},1581:function(e,t,n){},1593:function(e,t,n){"use strict";var a=n(1),i=n(13),s=n(0),r=n.n(s),o=n(453),c=n(1546),d=n(452);t.a=Object(s.memo)((function(e){var t=e.additionalClassName,n=e.disabled,l=void 0!==n&&n,u=e.labelContent,p=e.onChange,m=e.name,h=e.id,g=Object(s.useCallback)((function(e){var t=e.field;return r.a.createElement(s.Fragment,null,r.a.createElement(c.a,Object(a.__assign)({},t,{checked:!!t.value,disabled:l,id:h||t.name,label:u})),r.a.createElement(d.a,{name:m,testId:Object(i.kebabCase)(m)+"-field-error-message"}))}),[l,h,u,m]);return r.a.createElement(o.a,{additionalClassName:t,name:m,onChange:p,render:g})}))},1594:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(460);function i(e){return Object(a.a)(e.lineItems.physicalItems.filter((function(e){return!e.addedByPromotion})))}},1600:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1),i=n(13),s=n(0),r=n.n(s),o=n(1701),c=n(91),d=n(1553),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t.getContextValue=Object(c.memoizeOne)((function(e){return{onToggle:t.handleToggleItem,selectedItemId:e}})),t.handleToggleItem=function(e){var n=t.props,a=n.isDisabled,s=n.onSelect,r=void 0===s?i.noop:s;a||(t.setState({selectedItemId:e}),r(e))},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.children,n=e.className,a=void 0===n?"accordion":n,i=e.defaultSelectedItemId,s=this.state.selectedItemId,o=void 0===s?i:s;return r.a.createElement(d.a.Provider,{value:this.getContextValue(o)},r.a.createElement("ul",{className:a},t))},t}(s.Component),u=Object(s.createContext)(void 0);t.b=Object(o.a)(Object(s.memo)((function(e){var t=e.formik.setFieldValue,n=e.name,o=e.onSelect,c=void 0===o?i.noop:o,d=Object(a.__rest)(e,["formik","name","onSelect"]),p=Object(s.useCallback)((function(e){t(n,e),c(e)}),[n,c,t]),m=Object(s.useMemo)((function(){return{name:n}}),[n]);return r.a.createElement(u.Provider,{value:m},r.a.createElement(l,Object(a.__assign)({},d,{className:"form-checklist optimizedCheckout-form-checklist",onSelect:p})))})))},1603:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(13);function i(e){var t=[];return Object(a.forIn)(e,(function(e,n){var i;if(Object(a.isDate)(e)){var s=Object(a.padStart)((e.getMonth()+1).toString(),2,"0"),r=Object(a.padStart)(e.getDate().toString(),2,"0");i=e.getFullYear()+"-"+s+"-"+r}else i=e;t.push({fieldId:n,fieldValue:i})})),t}},1604:function(e,t,n){"use strict";var a=n(1),i=n(0),s=n.n(i),r=n(1567),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shouldShow:!1},t.handleClick=function(e){t.state.shouldShow?t.handleClose(e.nativeEvent):t.handleOpen(e.nativeEvent)},t.handleOpen=function(){t.state.shouldShow||t.setState({shouldShow:!0},(function(){document.addEventListener("click",t.handleClose)}))},t.handleClose=function(){t.state.shouldShow&&t.setState({shouldShow:!1},(function(){document.removeEventListener("click",t.handleClose)}))},t}return Object(a.__extends)(t,e),t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleClose)},t.prototype.render=function(){var e=this,t=this.props,n=t.children,i=t.placement,o=t.dropdown,c=this.state.shouldShow;return s.a.createElement(r.Manager,null,s.a.createElement(r.Reference,null,(function(t){var a=t.ref;return s.a.createElement("div",{className:"dropdownTrigger",onClick:e.handleClick,ref:a},n)})),s.a.createElement(r.Popper,{modifiers:{hide:{enabled:!1},flip:{enabled:!1},preventOverflow:{enabled:!1}},placement:i},(function(e){var t=e.ref,n=e.style;return c?s.a.createElement("div",{className:"dropdownMenu",ref:t,style:Object(a.__assign)(Object(a.__assign)({},n),{width:"100%",zIndex:1})},o):null})))},t.defaultProps={placement:"bottom-start"},t}(i.Component);t.a=o},1656:function(e,t,n){"use strict";var a=n(1498),i=n(261),s=Object(a.a)(i.a,{displayNamePrefix:"withDate",pickProps:function(e,t){return"date"===t&&!!e}});t.a=s},1661:function(e,t,n){"use strict";function a(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelector("a");if(!n)return[];var a=t.innerHTML.split(n.outerHTML);return[a[0],n.text,a[1]]}n.d(t,"a",(function(){return a}))},1669:function(e,t,n){"use strict";var a=n(1),i=n(91),s=n(13),r=n(0),o=n.n(r),c=n(324),d=n(262),l=n(210),u=n(1532),p=n(1674),m=n(1593),h={address1:"addressLine1",address2:"addressLine2",postalCode:"postCode",stateOrProvince:"province",stateOrProvinceCode:"provinceCode"};function g(e){return""+(h[e]||e)}function f(e){return g(e)+"Input"}var b=function(){function e(e){var t=e.address_components,n=e.name;this._name=n,this._address=t}return e.prototype.getState=function(){return this._get("administrative_area_level_1","short_name")},e.prototype.getStreet=function(){return this._name},e.prototype.getStreet2=function(){return""},e.prototype.getCity=function(){return this._get("postal_town","long_name")||this._get("locality","long_name")||this._get("neighborhood","short_name")},e.prototype.getCountry=function(){return this._get("country","short_name")},e.prototype.getPostCode=function(){return this._get("postal_code","short_name")},e.prototype._get=function(e,t){var n=this._address&&this._address.find((function(t){return-1!==t.types.indexOf(e)}));return n?n[t]:""},e}(),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.getState=function(){return this._get("administrative_area_level_2","long_name")},t.prototype.getStreet2=function(){return this._get("locality","long_name")},t}(b),C=function(){function e(){}return e.create=function(e){var t=new b(e);switch(t.getCountry()){case"GB":return new v(e)}return t},e}();var S=n(1506),O=n(448),_=n(1607),E=n.n(_),y=(n(1580),function(e){var t=e.children;return o.a.createElement("div",{className:"popover"},t)});n(1581);function A(e,t){var n=["popoverList-item"];return e===t&&n.push("is-active"),n.join(" ")}var j,k=Object(r.memo)((function(e){var t=e.highlightedIndex,n=void 0===t?-1:t,i=e.testId,s=e.getItemProps,r=void 0===s?function(e){return e}:s,c=e.menuProps,d=void 0===c?{}:c,l=e.items;return l&&l.length?o.a.createElement("ul",Object(a.__assign)({className:"popoverList","data-test":i},d),l.map((function(e,t){return o.a.createElement("li",Object(a.__assign)({className:A(n,t),"data-test":i&&i+"-item"},r({key:e.id,index:t,item:e}),{key:t}),e.content)}))):null})),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateReducer=function(e,n){var i=t.props.onChange;switch(n.type){case E.a.stateChangeTypes.blurInput:case E.a.stateChangeTypes.blurButton:case E.a.stateChangeTypes.mouseUp:case E.a.stateChangeTypes.touchEnd:return Object(a.__assign)(Object(a.__assign)({},n),{inputValue:e.inputValue});case E.a.stateChangeTypes.changeInput:return n.inputValue!==e.inputValue&&i&&i(n.inputValue||"",e.isOpen),n;case E.a.stateChangeTypes.keyDownEnter:default:return n}},t.handleStateChange=function(e){var n=e.isOpen,a=e.inputValue,i=t.props.onToggleOpen,r=void 0===i?s.noop:i;void 0!==n&&r({isOpen:n,inputValue:a||""})},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.inputProps,i=t.initialValue,r=t.initialHighlightedIndex,c=t.items,d=t.children,l=t.onSelect,u=t.listTestId;return o.a.createElement(E.a,{defaultHighlightedIndex:0,initialHighlightedIndex:r,initialInputValue:i,itemToString:this.itemToString,labelId:n&&n["aria-labelledby"]?n["aria-labelledby"]:null,onChange:l,onStateChange:this.handleStateChange,stateReducer:this.stateReducer},(function(t){var i=t.isOpen,r=t.getInputProps,l=t.getMenuProps,p=t.getItemProps,m=t.highlightedIndex;return o.a.createElement("div",null,o.a.createElement("input",Object(a.__assign)({},r(),n)),i&&!!c.length&&o.a.createElement(y,null,o.a.createElement(k,{getItemProps:p,highlightedIndex:Object(s.isNumber)(m)?m:-1,items:c.map((function(t){return e.toPopoverItem(t)})),menuProps:l(),testId:u}),d))}))},t.prototype.toPopoverItem=function(e){return Object(a.__assign)(Object(a.__assign)({},e),{content:this.highlightItem(e)})},t.prototype.highlightItem=function(e){if(!e.highlightedSlices||!e.highlightedSlices.length)return e.label;var t=0,n=0;return e.highlightedSlices.reduce((function(a,i,s){var c=e.label,d=i.offset,l=i.length,u=d-t;return u&&(a.push(o.a.createElement(r.Fragment,{key:n},c.substr(t,u))),n+=1),t=d+l,a.push(o.a.createElement("strong",{key:n},c.substr(d,l))),n+=1,s===(e.highlightedSlices||[]).length-1&&(a.push(o.a.createElement(r.Fragment,{key:n},c.substr(t))),n+=1),a}),[])},t.prototype.itemToString=function(e){return e&&e.value||""},t}(r.PureComponent),w=(n(1579),n(703)),N=function(){function e(){this._scriptLoader=Object(w.getScriptLoader)()}return e.prototype.loadMapsSdk=function(e){var t=this;return this._googleAutoComplete?this._googleAutoComplete:(this._googleAutoComplete=new Promise((function(n,a){var i=["language=en","key="+e,"libraries=places","callback=initAutoComplete"].join("&");window.initAutoComplete=function(){(function(e){var t=e;return Boolean(t.google&&t.google.maps&&t.google.maps.places)})(window)&&n(window.google.maps),a()},t._scriptLoader.loadScript("//maps.googleapis.com/maps/api/js?"+i).catch((function(e){throw t._googleAutoComplete=void 0,e}))})),this._googleAutoComplete)},e}();var F=function(){function e(e,t){void 0===t&&(j||(j=new N),t=j),this._apiKey=e,this._scriptLoader=t}return e.prototype.getAutocompleteService=function(){return this._autocompletePromise||(this._autocompletePromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(e){if(!e.places.AutocompleteService)throw new Error("`AutocompleteService` is undefined");return new e.places.AutocompleteService}))),this._autocompletePromise},e.prototype.getPlacesServices=function(){var e=document.createElement("div");return this._placesPromise||(this._placesPromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(t){if(!t.places.PlacesService)throw new Error("`PlacesService` is undefined");return new t.places.PlacesService(e)}))),this._placesPromise},e}(),M=function(e){function t(t){var n=e.call(this,t)||this;return n.onSelect=function(e){var t=n.props,a=t.fields,i=t.onSelect,r=void 0===i?s.noop:i,o=t.nextElement;n.googleAutocompleteService.getPlacesServices().then((function(t){t.getDetails({placeId:e.id,fields:a||["address_components","name"]},(function(t){o&&o.focus(),r(t,e)}))}))},n.onChange=function(e){var t=n.props,a=t.isAutocompleteEnabled,i=t.onChange;if((void 0===i?s.noop:i)(e,!1),!a)return n.resetAutocomplete();n.setAutocomplete(e),n.setItems(e)},n.googleAutocompleteService=new F(t.apiKey),n.state={items:[],autoComplete:"off"},n}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.initialValue,n=e.onToggleOpen,i=void 0===n?s.noop:n,r=e.inputProps,c=void 0===r?{}:r,d=this.state,l=d.autoComplete,u=d.items;return o.a.createElement(I,{initialHighlightedIndex:0,initialValue:t,inputProps:Object(a.__assign)(Object(a.__assign)({},c),{autoComplete:l}),items:u,listTestId:"address-autocomplete-suggestions",onChange:this.onChange,onSelect:this.onSelect,onToggleOpen:i},o.a.createElement("div",{className:"co-googleAutocomplete-footer"}))},t.prototype.setItems=function(e){var t=this;if(e){var n=this.props,a=n.componentRestrictions,i=n.types;this.googleAutocompleteService.getAutocompleteService().then((function(n){n.getPlacePredictions({input:e,types:i||["geocode"],componentRestrictions:a},(function(e){return t.setState({items:t.toAutocompleteItems(e)})}))}))}else this.setState({items:[]})},t.prototype.resetAutocomplete=function(){this.setState({items:[],autoComplete:"off"})},t.prototype.setAutocomplete=function(e){this.setState(Object(a.__assign)(Object(a.__assign)({},this.state),{autoComplete:e&&e.length?"nope":"off"}))},t.prototype.toAutocompleteItems=function(e){return(e||[]).map((function(e){return{label:e.description,value:e.structured_formatting.main_text,highlightedSlices:e.matched_substrings,id:e.place_id}}))},t}(r.PureComponent),P=Object(r.memo)((function(e){var t=e.field,n=t.default,a=t.name,i=e.countryCode,s=e.supportedCountries,d=e.parentFieldName,l=e.nextElement,u=e.apiKey,p=e.onSelect,m=e.onChange,h=e.onToggleOpen,b=d?d+"."+a:a,v=Object(r.useMemo)((function(){return o.a.createElement(c.a,{id:"address.address_line_1_label"})}),[]),C=function(e){return g(e)+"Label"}(a),_=Object(r.useMemo)((function(){return{className:"form-input optimizedCheckout-form-input",id:f(a),"aria-labelledby":C,placeholder:n}}),[a,C,n]),E=Object(r.useCallback)((function(e){var t=e.field;return o.a.createElement(M,{apiKey:u,componentRestrictions:i?{country:i}:void 0,initialValue:t.value,inputProps:_,isAutocompleteEnabled:!!i&&s.indexOf(i)>-1,nextElement:l,onChange:m,onSelect:p,onToggleOpen:h})}),[u,i,_,l,m,p,h,s]);return o.a.createElement("div",{className:"dynamic-form-field dynamic-form-field--addressLineAutocomplete"},o.a.createElement(S.a,{input:E,label:o.a.createElement(O.a,{htmlFor:_.id,id:C},v),name:b}))})),x=(n(1578),{address1:"address.address_line_1_label",address2:"address.address_line_2_label",city:"address.city_label",company:"address.company_name_label",countryCode:"address.country_label",firstName:"address.first_name_label",lastName:"address.last_name_label",phone:"address.phone_number_label",postalCode:"address.postal_code_label",stateOrProvince:"address.state_label",stateOrProvinceCode:"address.state_label"}),V={address1:"address-line1",address2:"address-line2",city:"address-level2",company:"organization",countryCode:"country",firstName:"given-name",lastName:"family-name",phone:"tel",postalCode:"postal-code",stateOrProvince:"address-level1",stateOrProvinceCode:"address-level1"},T={countryCode:"address.select_country_action",stateOrProvince:"address.select_state_action",stateOrProvinceCode:"address.select_state_action"},z="address1",L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.containerRef=Object(r.createRef)(),t.handleDynamicFormFieldChange=Object(i.memoize)((function(e){return function(n){t.syncNonFormikValue(e,n)}})),t.handleAutocompleteChange=function(e,n){n||t.syncNonFormikValue(z,e)},t.handleAutocompleteSelect=function(e,n){var i=n.value,r=t.props,o=r.countries,c=r.setFieldValue,d=void 0===c?s.noop:c,l=r.onChange,u=void 0===l?s.noop:l,p=function(e,t){if(void 0===t&&(t=[]),!e||!e.address_components)return{};var n=C.create(e),i=n.getState(),s=n.getCountry(),r=t&&t.find((function(e){return s===e.code})),o=n.getStreet2();return Object(a.__assign)({address2:o,city:n.getCity(),countryCode:s,postalCode:n.getPostCode()},i?function(e,t){void 0===t&&(t=[]);var n=t.find((function(t){var n=t.code,a=t.name;return n===e||a===e}));if(!n)return{stateOrProvince:t.length?"":e,stateOrProvinceCode:""};return{stateOrProvince:n.name,stateOrProvinceCode:n.code}}(i,r&&r.subdivisions):{})}(e,o);Object(s.forIn)(p,(function(e,t){d(t,e),u(t,e)})),i&&t.syncNonFormikValue(z,i)},t.syncNonFormikValue=function(e,n){var a=t.props,i=a.formFields,r=a.setFieldValue,o=void 0===r?s.noop:r,c=a.onChange,d=void 0===c?s.noop:c,u=i.filter((function(e){return e.custom&&e.fieldType===l.a.date})).map((function(e){return e.name}));(e===z||u.indexOf(e)>-1)&&o(e,n),d(e,n)},t}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.containerRef.current;e&&(this.nextElement=e.querySelector('[autocomplete="address-line2"]'))},t.prototype.render=function(){var e=this,t=this.props,n=t.formFields,a=t.fieldName,i=t.language,s=t.countriesWithAutocomplete,r=t.countryCode,d=t.googleMapsApiKey,l=t.onAutocompleteToggle,h=t.shouldShowSaveAddress;return o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,null,o.a.createElement("div",{className:"checkout-address",ref:this.containerRef},n.map((function(t){var n=t.name,u=T[n];return"address1"===n&&d&&s?o.a.createElement(P,{apiKey:d,countryCode:r,field:t,key:t.id,nextElement:e.nextElement||void 0,onChange:e.handleAutocompleteChange,onSelect:e.handleAutocompleteSelect,onToggleOpen:l,parentFieldName:a,supportedCountries:s}):o.a.createElement(p.a,{autocomplete:V[t.name],extraClass:"dynamic-form-field--"+g(n),field:t,inputId:f(n),key:t.id+"-"+t.name,label:t.custom?t.label:o.a.createElement(c.a,{id:x[t.name]}),onChange:e.handleDynamicFormFieldChange(n),parentFieldName:t.custom?a?a+".customFields":"customFields":a,placeholder:t.default?t.default:u&&i.translate(u)})})))),h&&o.a.createElement(m.a,{labelContent:o.a.createElement(c.a,{id:"address.save_in_addressbook"}),name:a?a+".shouldSaveAddress":"shouldSaveAddress"}))},t}(r.Component);t.a=Object(d.a)(L)},1674:function(e,t,n){"use strict";var a=n(1),i=n(0),s=n.n(i),r=n(324),o=n(114),c=n(13),d=n(210),l=n(1568),u=n.n(l),p=n(1656),m=n(1546),h=n(1548),g=n(1557),f=n(1502),b=Object(i.memo)(Object(p.a)((function(e){e.additionalClassName;var t=e.date,n=e.fieldType,r=e.id,o=e.name,l=e.onChange,p=void 0===l?c.noop:l,b=e.options,v=e.placeholder,C=e.value,S=Object(a.__rest)(e,["additionalClassName","date","fieldType","id","name","onChange","options","placeholder","value"]),O=t.inputFormat,_=Object(i.useCallback)((function(e,t){return p(Object(a.__assign)(Object(a.__assign)({},t),{target:{name:o,value:e}}))}),[p,o]);switch(n){case d.a.dropdown:return s.a.createElement("select",Object(a.__assign)({},S,{className:"form-select optimizedCheckout-form-select","data-test":r+"-select",id:r,name:o,onChange:p,value:null===C?"":C}),v&&s.a.createElement("option",{value:""},v),b&&b.map((function(e){var t=e.label,n=e.value;return s.a.createElement("option",{key:n,value:n},t)})));case d.a.radio:return b&&b.length?s.a.createElement(s.a.Fragment,null,b.map((function(e){var t=e.label,n=e.value;return s.a.createElement(h.a,Object(a.__assign)({},S,{checked:n===C,id:r+"-"+n,key:n,label:t,name:o,onChange:p,testId:r+"-"+n+"-radio",value:n}))}))):null;case d.a.checkbox:return b&&b.length?s.a.createElement(s.a.Fragment,null,b.map((function(e){var t=e.label,n=e.value;return s.a.createElement(m.a,Object(a.__assign)({},S,{checked:!!Array.isArray(C)&&C.includes(n),id:r+"-"+n,key:n,label:t,name:o,onChange:p,testId:r+"-"+n+"-checkbox",value:n}))}))):null;case d.a.date:return s.a.createElement(u.a,Object(a.__assign)({},S,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:"form-input optimizedCheckout-form-input",dateFormat:O,maxDate:S.max?new Date(S.max+"T00:00:00Z"):void 0,minDate:S.min?new Date(S.min+"T00:00:00Z"):void 0,name:o,onChange:_,placeholderText:O.toUpperCase(),popperClassName:"optimizedCheckout-contentPrimary",selected:Object(c.isDate)(C)?C:void 0}));case d.a.multiline:return s.a.createElement(g.a,Object(a.__assign)({},S,{id:r,name:o,onChange:p,testId:r+"-text",type:n,value:C}));default:return s.a.createElement(f.a,Object(a.__assign)({},S,{id:r,name:o,onChange:p,placeholder:v,testId:r+"-"+(n===d.a.password?"password":"text"),type:n,value:C}))}}))),v=n(457),C=n(452),S=(n(1564),Object(i.memo)((function(e){var t=e.testId,n=e.onSelectedAll,a=e.onSelectedNone,o=Object(i.useCallback)((function(e){e.preventDefault(),n()}),[n]),c=Object(i.useCallback)((function(e){e.preventDefault(),a()}),[a]);return s.a.createElement("ul",{className:"multiCheckbox--controls"},s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement(r.a,{id:"address.select"})),s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement("a",{"data-test":t+"Checkbox-all-button",href:"#",onClick:o},s.a.createElement(r.a,{id:"address.select_all"}))),s.a.createElement("li",{className:"multiCheckbox--control"},s.a.createElement("a",{"data-test":t+"Checkbox-none-button",href:"#",onClick:c},s.a.createElement(r.a,{id:"address.select_none"}))))}))),O=function(e){var t=e.form,n=t.values,a=t.errors,r=e.id,l=e.label,u=e.name,p=e.onChange,m=void 0===p?c.noop:p,h=e.options,g=e.push,f=e.remove,O=Object(i.useCallback)((function(){var e=Object(o.getIn)(n,u)||[];Object(c.difference)(h.map((function(e){return e.value})),e).forEach((function(e){return g(e)})),m(Object(o.getIn)(n,u))}),[u,m,h,g,n]),_=Object(i.useCallback)((function(){(Object(o.getIn)(n,u)||[]).forEach((function(){return f(0)})),m(Object(o.getIn)(n,u))}),[u,m,f,n]),E=Object(i.useCallback)((function(e){var t=Object(o.getIn)(n,u)||[],a=e.target,i=a.value;a.checked?g(i):f(t.indexOf(i)),m(Object(o.getIn)(n,u))}),[u,m,g,f,n]);return s.a.createElement(v.a,{hasError:Object(o.getIn)(a,u)&&Object(o.getIn)(a,u).length},l,h.length>1&&s.a.createElement(S,{onSelectedAll:O,onSelectedNone:_,testId:r}),s.a.createElement(b,{fieldType:d.a.checkbox,id:r,name:u,onChange:E,options:h,value:Object(o.getIn)(n,u)||[]}),s.a.createElement(C.a,{name:u,testId:Object(c.kebabCase)(u)+"-field-error-message"}))},_=Object(i.memo)((function(e){var t=e.id,n=e.label,r=e.name,d=e.onChange,l=e.options,u=Object(i.useCallback)((function(e){return s.a.createElement(O,Object(a.__assign)({id:t,label:n,name:r,onChange:d,options:l},Object(c.pick)(e,["form","pop","push","remove"])))}),[t,n,r,d,l]);return s.a.createElement(o.FieldArray,{name:r,render:u})})),E=n(1506),y=n(448);t.a=Object(i.memo)((function(e){var t=e.field,n=t.fieldType,o=t.type,c=t.secret,l=t.name,u=t.label,p=t.required,m=t.options,h=t.max,g=t.min,f=t.maxLength,v=e.parentFieldName,C=e.onChange,S=e.placeholder,O=e.inputId,A=e.autocomplete,j=e.label,k=e.extraClass,I=O||l,w=v?v+"."+l:l,N=Object(i.useMemo)((function(){return s.a.createElement(y.a,{htmlFor:I},j||u,!p&&s.a.createElement(s.a.Fragment,null," ",s.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},s.a.createElement(r.a,{id:"common.optional_text"}))))}),[I,u,p,j]),F=Object(i.useMemo)((function(){return"text"===n?"integer"===o?d.a.number:c?d.a.password:d.a.text:n}),[n,o,c]),M=Object(i.useCallback)((function(e){var t=e.field;return s.a.createElement(b,Object(a.__assign)({},t,{autoComplete:A,fieldType:F,id:I,max:h,maxLength:f||void 0,min:g,options:m&&m.items,placeholder:S||m&&m.helperLabel,rows:m&&m.rows}))}),[I,h,f,g,m,S,F,A]);return s.a.createElement("div",{className:"dynamic-form-field "+k},n===d.a.checkbox?s.a.createElement(_,{id:I,label:N,name:w,onChange:C,options:m&&m.items||[]}):s.a.createElement(E.a,{input:M,label:N,name:w,onChange:C}))}))},1686:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(1),i=n(1603);function s(e){var t=e.customFields,n=Object(a.__rest)(e,["customFields"]),s=e.shouldSaveAddress;return Object(a.__assign)(Object(a.__assign)({},n),{shouldSaveAddress:s,customFields:Object(i.a)(t)})}},1696:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(695),i=n(1531);function s(e){return(e&&e.payments?e.payments:[]).find((function(e){return!Object(a.a)(e)&&!Object(i.a)(e)&&!!e.providerId}))}},1697:function(e,t,n){"use strict";var a=n(0),i=n.n(a),s=n(1496),r=n(1661),o=n(262);t.a=Object(o.a)((function(e){var t=e.data,n=e.id,a=e.language,o=e.onClick,c=e.testId,d=a.translate(n,t),l=Object(r.a)(d);return l.length?i.a.createElement(i.a.Fragment,null,l[0],i.a.createElement("a",{"data-test":c,href:"#",onClick:Object(s.a)(o)},l[1]),l[2]):i.a.createElement(i.a.Fragment,null,d)}))},1701:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(1),i=n(114),s=n(0),r=n.n(s),o=n(98),c=n.n(o);function d(e){var t=Object(s.memo)((function(t){return r.a.createElement(e,Object(a.__assign)({},t))}),(function(e,t){var n=e.formik,i=Object(a.__rest)(e,["formik"]),s=t.formik,r=Object(a.__rest)(t,["formik"]);return c()(n,s)&&c()(i,r)})),n=Object(i.connect)(t);return n.displayName="ConnectFormik("+(e.displayName||e.name)+")",n}},1703:function(e,t,n){},1715:function(e,t,n){},1716:function(e,t,n){"use strict";var a=n(1),i=n(91),s=n(13),r=n(0),o=n.n(r),c=n(40),d=n.n(c),l=n(455),u=n(1553),p=Object(r.memo)((function(e){var t,n,a=e.bodyClassName,i=void 0===a?"accordion-item-body":a,s=e.children,c=e.className,p=void 0===c?"accordion-item":c,m=e.classNameSelected,h=void 0===m?"accordion-item--selected":m,g=e.headerClassName,f=void 0===g?"accordion-item-header":g,b=e.headerClassNameSelected,v=void 0===b?"accordion-item-header--selected":b,C=e.headerContent,S=e.itemId,O=Object(r.useContext)(u.a),_=O.onToggle,E=O.selectedItemId===S,y=Object(r.useCallback)((function(e,t){e.addEventListener("transitionend",(function(n){n.target===e&&t()}))}),[]);return o.a.createElement("li",{className:d()(p,(t={},t[h]=E,t))},o.a.createElement("div",{className:d()(f,(n={},n[v]=E,n))},C({isSelected:E,onToggle:_})),s&&o.a.createElement(l.CSSTransition,{addEndListener:y,classNames:i,in:E,mountOnEnter:!0,timeout:{},unmountOnExit:!0},o.a.createElement("div",{className:i},s)))})),m=n(453),h=n(1600),g=n(450),f=n(448),b=function(e){var t=e.id,n=e.isSelected,i=e.children,s=Object(a.__rest)(e,["id","isSelected","children"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(g.a,Object(a.__assign)({},s,{checked:n,className:"form-checklist-checkbox optimizedCheckout-form-checklist-checkbox",id:t,type:"radio"})),o.a.createElement(f.a,{htmlFor:t},i))};t.a=Object(r.memo)((function(e){var t=e.isDisabled,n=e.value,c=e.content,d=e.htmlId,l=void 0===d?Object(s.kebabCase)(n):d,u=e.label,g=Object(a.__rest)(e,["isDisabled","value","content","htmlId","label"]),f=(Object(r.useContext)(h.a)||{}).name,v=void 0===f?"":f,C=Object(r.useCallback)(Object(i.memoizeOne)((function(e){return function(i){var s=i.field;return o.a.createElement(b,Object(a.__assign)({},s,{disabled:t,id:l,isSelected:s.value===n,value:n}),u instanceof Function?u(e):u)}})),[l,t,u,n]),S=Object(r.useCallback)(Object(i.memoizeOne)((function(e){return function(t){n===t&&e(n)}})),[]),O=Object(r.useCallback)((function(e){var t=e.isSelected,n=e.onToggle;return o.a.createElement(m.a,{className:"form-checklist-option",name:v,onChange:S(n),render:C(t)})}),[S,v,C]);return o.a.createElement(p,Object(a.__assign)({},g,{bodyClassName:"form-checklist-body",className:"form-checklist-item optimizedCheckout-form-checklist-item",classNameSelected:"form-checklist-item--selected optimizedCheckout-form-checklist-item--selected",headerClassName:"form-checklist-header",headerClassNameSelected:"form-checklist-header--selected",headerContent:O,itemId:n}),c)}))},1717:function(e,t,n){"use strict";var a=n(1),i=n(0),s=n.n(i),r=n(1496),o=n(324),c=n(1604),d=n(1548),l=n(1534),u=n(1532),p=n(448),m=n(1502),h=n(459),g=(n(1575),n(708)),f=n(13),b=(n(1556),n(262)),v=Object(b.a)((function(e){var t=e.onChange,n=e.language,a=Object(i.createRef)(),r=Object(f.debounce)((function(e){t&&t(e)}),200);return Object(i.useEffect)((function(){var e=a.current;return e&&(e.onclick=function(e){e.stopPropagation()}),function(){}})),s.a.createElement("div",{className:"cc-address-search-container",ref:a},s.a.createElement(m.a,{placeholder:n.translate("shipping.searchAddress_label"),onChange:function(e){r(e.target.value)}}))})),C=n(48),S={address1:"",address2:"",city:"",company:"",country:"USA",countryCode:"US",customFields:[],firstName:"",id:"",lastName:"",phone:"",postalCode:"",stateOrProvince:"",stateOrProvinceCode:"",type:"residential"},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shippingAddressMethod:C.storage.CCShippingMethod.getValue()?C.storage.CCShippingMethod.getValue():"buildIn",OTSAddress:C.storage.CCOTSAddress.getValue()?JSON.parse(C.storage.CCOTSAddress.getValue()):S},t.handleShippingAddressMethodChange=function(e){C.storage.CCShippingMethod.setValue(e.target.value),t.setState({shippingAddressMethod:e.target.value}),console.log("after set, storage.CCShippingMethod value:"+C.storage.CCShippingMethod.getValue())},t.handleSelectAddress=function(e){var n=t.props,a=n.onSelectAddress,i=n.selectedAddress;Object(h.a)(i,e)||a(e)},t.handleUseNewAddress=function(){var e=t.props,n=e.selectedAddress;(0,e.onUseNewAddress)(n)},t.handleFieldValueChange=function(e){return function(n){t.state.OTSAddress[e]=n.target.value,"stateOrProvince"==e&&(t.state.OTSAddress.stateOrProvinceCode=n.target.value),"firstName"==e&&(t.state.OTSAddress.lastName=n.target.value),t.setState({OTSAddress:Object(a.__assign)({},t.state.OTSAddress)}),C.storage.CCOTSAddress.setValue(JSON.stringify(t.state.OTSAddress))}},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.addresses,a=t.selectedAddress,i=this.state,r=i.shippingAddressMethod,h=i.OTSAddress,g=C.storage.CCAllowOTS.getValue();console.log("allowOTS:"+g);var f=a&&a.customFields&&0==a.customFields.length;return s.a.createElement("div",{className:"form-field"},s.a.createElement(d.a,{checked:"buildIn"==r,id:"addr-methohd-default",key:"buildIn",label:"Choose from the address book:",name:"shippingAddressMethod",onChange:this.handleShippingAddressMethodChange,value:"buildIn"}),"buildIn"==r?s.a.createElement("div",{className:"dropdown--select",role:"combobox"},s.a.createElement(c.a,{dropdown:s.a.createElement(_,{addresses:n,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:f?void 0:a})},s.a.createElement(E,{addresses:n,selectedAddress:a}))):"","true"==g?s.a.createElement(d.a,{checked:"OTS"==r,id:"addr-method-ots",key:"OTS",label:"Specify a one-time shipping address (US only):",name:"shippingAddressMethod",onChange:this.handleShippingAddressMethodChange,value:"OTS"}):"","true"==g&&"OTS"==r?s.a.createElement(l.a,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},s.a.createElement(u.a,null,s.a.createElement("div",{className:"create-account-form"},[{id:"firstName",name:"firstName",custom:!1,label:"Contact Name",required:!0},{id:"company",name:"company",custom:!1,label:"Company Name",required:!0},{id:"address1",name:"address1",custom:!1,label:"Address Line 1",required:!0},{id:"address2",name:"address2",custom:!1,label:"Address Line 2",required:!1},{id:"city",name:"city",custom:!1,label:"City",required:!0},{id:"stateOrProvince",name:"stateOrProvince",custom:!1,label:"State",required:!0},{id:"postalCode",name:"postalCode",custom:!1,label:"Zip Code",required:!0},{id:"phone",name:"phone",custom:!1,label:"Phone Number",required:!1}].map((function(t){return s.a.createElement("div",{className:"dynamic-form-field"},s.a.createElement("div",{className:"form-field"},s.a.createElement(p.a,{htmlFor:t.id},t.label,t.required?s.a.createElement(s.a.Fragment,null," ",s.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},"(Required)")):s.a.createElement(s.a.Fragment,null," ",s.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},s.a.createElement(o.a,{id:"common.optional_text"})))),s.a.createElement(m.a,{id:t.id,name:t.name,onChange:e.handleFieldValueChange(t.name),value:h[t.name]})))}))))):"")},t}(i.PureComponent),_=function(e){var t=e.addresses,n=e.onSelectAddress,a=Object(i.useState)(t),o=a[0],c=a[1];return s.a.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},s.a.createElement(v,{onChange:function(e){c(function(e,t){return t.filter((function(t){return JSON.stringify(t).trim().toLocaleLowerCase().includes(e.trim().toLocaleLowerCase())}))}(e,t))}}),o.map((function(e){return s.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select",key:e.id},s.a.createElement("a",{href:"#",onClick:Object(r.a)((function(){return n(e)}))},s.a.createElement(g.a,{address:e})))})))},E=function(e){var t=e.selectedAddress;return s.a.createElement("a",{className:"button dropdown-button dropdown-toggle--select",href:"#",id:"addressToggle",onClick:Object(r.a)()},t?s.a.createElement(g.a,{address:t}):s.a.createElement(o.a,{id:"address.enter_address_action"}))};t.a=Object(i.memo)(O)},1726:function(e,t,n){"use strict";n.r(t),n.d(t,"mapToShippingProps",(function(){return Ke}));var a=n(1),i=n(13),s=n(0),r=n.n(s),o=n(121),c=n(1686),d=n(459),l=n(446),u=n(1499),p=n(1525),m=n(1519),h=n(685),g=n(318),f=function(e){function t(n){var a=e.call(this,{name:"UNASSIGN_ITEM_FAILED",message:Object(g.a)().translate("shipping.unassign_item_error"),data:n})||this;return Object(m.a)(a,t.prototype),a}return Object(a.__extends)(t,e),t}(h.a),b=n(1594),v=n(1696);function C(e){var t=Object(v.a)(e);return t&&["amazon","amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var S=n(262),O=n(114),_=n(1530),E=n(70),y=n(1496),A=n(324),j=n(1524),k=n(1534),I=n(1510),w=n(1522),N=n(683),F=n(1669),M=Object(S.a)(Object(O.withFormik)({handleSubmit:function(e,t){(0,t.props.onSaveAddress)(e)},mapPropsToValues:function(e){var t=e.defaultCountryCode;return{firstName:"",lastName:"",address1:"",address2:"",customFields:{},country:"",countryCode:void 0===t?"":t,stateOrProvince:"",stateOrProvinceCode:"",postalCode:"",phone:"",city:"",company:"",shouldSaveAddress:!1}},validationSchema:function(e){var t=e.language,n=e.getFields;return Object(E.lazy)((function(e){return Object(N.a)({language:t,formFields:n(e&&e.countryCode)})}))}})((function(e){var t=e.googleMapsApiKey,n=e.getFields,a=e.countriesWithAutocomplete,i=e.countries,s=e.values,o=e.setFieldValue,c=e.isLoading,d=e.onRequestClose;return r.a.createElement(k.a,{autoComplete:"on"},r.a.createElement(p.a,{isLoading:c},r.a.createElement(F.a,{countries:i,countriesWithAutocomplete:a,countryCode:s.countryCode,formFields:n(s.countryCode),googleMapsApiKey:t,setFieldValue:o,shouldShowSaveAddress:!1}),r.a.createElement("div",{className:"form-actions"},r.a.createElement("a",{className:"button optimizedCheckout-buttonSecondary",href:"#",onClick:Object(y.a)(d)},r.a.createElement(A.a,{id:"common.cancel_action"})),r.a.createElement(j.c,{disabled:c,id:"checkout-save-address",type:"submit",variant:j.b.Primary},r.a.createElement(A.a,{id:"address.save_address_action"})))))}))),P=function(e){var t=e.isOpen,n=e.onAfterOpen,i=e.onRequestClose,s=Object(a.__rest)(e,["isOpen","onAfterOpen","onRequestClose"]);return r.a.createElement(I.a,{additionalModalClassName:"modal--medium",header:r.a.createElement(w.a,null,r.a.createElement(A.a,{id:"address.add_address_heading"})),isOpen:t,onAfterOpen:n,onRequestClose:i,shouldShowCloseButton:!0},r.a.createElement(M,Object(a.__assign)({},s,{onRequestClose:i})))},x=n(1538),V=n(1697),T=function(e){function t(n){var a=e.call(this,{name:"ASSIGN_ITEM_INVALID_ADDRESS",message:Object(g.a)().translate("shipping.assign_item_invalid_address_error"),title:Object(g.a)().translate("shipping.assign_item_invalid_address_error_heading"),data:n})||this;return Object(m.a)(a,t.prototype),a}return Object(a.__extends)(t,e),t}(h.a),z=function(e){function t(n){var a=e.call(this,{name:"ASSIGN_ITEM_FAILED",message:Object(g.a)().translate("shipping.assign_item_error"),data:n})||this;return Object(m.a)(a,t.prototype),a}return Object(a.__extends)(t,e),t}(h.a);function L(e,t){return Object(i.find)(e,(function(e){return Object(i.includes)(e.lineItemIds,t)}))}function U(e,t){return Object(i.reduce)(e&&e.lineItems.physicalItems||[],(function(e,n,s){return!n.addedByPromotion&&Object(i.isNil)(n.parentId)?e.concat.apply(e,function(e,t,n){for(var i=[],s=L(t,e.id),r=0;r<e.quantity;r++)i=i.concat(Object(a.__assign)(Object(a.__assign)({},e),{key:e.variantId+"-"+e.productId+"-"+n+"-"+r,consignment:s,quantity:1}));return i}(n,t,s)):e}),[])}var D=n(1507),R=n(636);var B=n(1717),q=Object(s.memo)((function(e){var t=e.item,n=t.id,a=t.key,i=t.imageUrl,o=t.quantity,c=t.name,d=t.options,l=t.consignment,u=e.addresses,p=e.onSelectAddress,m=e.onUseNewAddress,h=Object(s.useCallback)((function(e){m(e,n,a)}),[n,m,a]),g=Object(s.useCallback)((function(e){p(e,n,a)}),[n,a,p]);return r.a.createElement("div",{className:"consignment"},r.a.createElement("figure",{className:"consignment-product-figure"},i&&r.a.createElement("img",{alt:c,src:i})),r.a.createElement("div",{className:"consignment-product-body"},r.a.createElement("h5",{className:"optimizedCheckout-contentPrimary"},o+" x "+c),(d||[]).map((function(e){var t=e.name,n=e.value,a=e.nameId;return r.a.createElement("ul",{className:"product-options optimizedCheckout-contentSecondary","data-test":"consigment-item-product-options",key:a},r.a.createElement("li",{className:"product-option"},t+" "+n))})),r.a.createElement(B.a,{addresses:u,onSelectAddress:g,onUseNewAddress:h,selectedAddress:l&&l.shippingAddress})))})),W=n(1568),K=n.n(W),H=n(1662),G=n(1668),J=n(1665),Y=n.n(J),Z=n(1656),Q=n(1533),X=n(1532),$=n(1502),ee=n(66),te=n(1546),ne=Object(s.memo)(Object(S.a)((function(e){var t=e.onChange,n=e.value,a=e.language,i=Object(s.useMemo)((function(){return r.a.createElement("span",null,r.a.createElement(A.a,{id:"shipping.onlyShipWhenComplete_label"}),r.a.createElement(H.FontAwesomeIcon,{"data-for":"main","data-tip":a.translate("shipping.onlyShipWhenComplete_help"),icon:G.faInfoCircle,className:"cc-info-icon cc-info-icon-label"}),r.a.createElement(Y.a,{id:"main",type:"info",multiline:!0}))}),[]);return r.a.createElement(te.a,{checked:"Y"===n,id:"onlyShipWhenComplete",label:i,onChange:t,value:n})}))),ae=n(1604),ie=Object(S.a)(Object(Z.a)((function(e){var t,n=e.date,a=e.language,i=JSON.parse(ee.a.CCShipViaOptions.getValue()),o=Object(s.useState)(ee.a.CCNeedBy.getValue()?new Date(ee.a.CCNeedBy.getValue()):null),c=o[0],d=o[1],l=Object(s.useState)(ee.a.CCShipWhenComplete.getValue()||""),u=l[0],p=l[1],m=Object(s.useState)(ee.a.CCShippingPreference.getValue()||""),h=m[0],g=m[1],f=Object(s.useState)(ee.a.CCReferLine.getValue()||""),b=f[0],v=f[1],C=Object(s.useState)((t=ee.a.CCShipVia.getValue(),i.find((function(e){return e.value==t}))||{label:"",value:""})),S=C[0],O=C[1],_=Object(s.useMemo)((function(){return r.a.createElement(Q.a,null,r.a.createElement(A.a,{id:"shipping.needBy_label"}),r.a.createElement(H.FontAwesomeIcon,{"data-for":"main","data-tip":a.translate("shipping.needBy_help"),icon:G.faInfoCircle,className:"cc-info-icon"}))}),[]),E=Object(s.useMemo)((function(){return r.a.createElement(Q.a,null,r.a.createElement(A.a,{id:"shipping.shippingPreference_label"}),r.a.createElement(H.FontAwesomeIcon,{"data-for":"main","data-tip":a.translate("shipping.shippingPreference_help"),icon:G.faInfoCircle,className:"cc-info-icon"}))}),[]),j=Object(s.useMemo)((function(){return r.a.createElement(Q.a,null,r.a.createElement(A.a,{id:"shipping.referLine_label"}),r.a.createElement(H.FontAwesomeIcon,{"data-for":"main","data-tip":a.translate("shipping.referLine_help"),icon:G.faInfoCircle,className:"cc-info-icon"}))}),[]),k=Object(s.useMemo)((function(){return r.a.createElement(Q.a,null,r.a.createElement(A.a,{id:"shipping.shipVia_label"}),r.a.createElement(H.FontAwesomeIcon,{"data-for":"main","data-tip":a.translate("shipping.shipVia_help"),icon:G.faInfoCircle,className:"cc-info-icon"}))}),[]);return r.a.createElement("div",null,r.a.createElement(X.a,{legend:j,testId:"checkout-shipping-referLine"},r.a.createElement($.a,{name:"referLine",autoComplete:"off",maxLength:2e3,onChange:function(e){var t=e.target.value;v(t),t?ee.a.CCReferLine.setValue(t):ee.a.CCReferLine.removeValue()},value:b})),r.a.createElement(X.a,{legend:_,testId:"checkout-shipping-needBy"},r.a.createElement(K.a,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:"form-input optimizedCheckout-form-input",dateFormat:n.inputFormat,name:"needBy",onChange:function(e){d(e),e?ee.a.CCNeedBy.setValue(e.toString()):ee.a.CCNeedBy.removeValue()},placeholderText:a.translate("shipping.needByPlaceHolder_label"),popperClassName:"optimizedCheckout-contentPrimary",selected:c}),r.a.createElement("p",{className:"cc-needby-note"},r.a.createElement(A.a,{id:"shipping.needBy_note"}))),r.a.createElement(X.a,{testId:"checkout-shipping-onlyShipWhenComplete"},r.a.createElement(ne,{onChange:function(e){p(e.target.checked?"Y":"N"),ee.a.CCShipWhenComplete.setValue(e.target.checked?"Y":"N")},value:u})),r.a.createElement(X.a,{id:"checkout-shipping-via-options",legend:k},r.a.createElement("div",{className:"form-field"},r.a.createElement("div",{className:"dropdown--select",role:"combobox"},r.a.createElement(ae.a,{dropdown:r.a.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},i.map((function(e){return r.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select",key:e.id},r.a.createElement("a",{href:"#",onClick:Object(y.a)((function(){return function(e){O(e),e?ee.a.CCShipVia.setValue(e.value):ee.a.CCShipVia.removeValue()}(e)}))},r.a.createElement("span",null,e.label)))})))},r.a.createElement("a",{className:"button dropdown-button dropdown-toggle--select",href:"#",id:"shipViaToggle",onClick:Object(y.a)()},r.a.createElement("span",null,S?S.label:"")))))),r.a.createElement(X.a,{legend:E,testId:"checkout-shipping-shippingPreference"},r.a.createElement($.a,{name:"shippingPreference",autoComplete:"off",maxLength:2e3,onChange:function(e){var t=e.target.value;g(t),t?ee.a.CCShippingPreference.setValue(t):ee.a.CCShippingPreference.removeValue()},value:h})),r.a.createElement(Y.a,{id:"main",type:"info",multiline:!0}))}))),se=n(1537),re=n(708);var oe=n(682),ce=(n(1703),n(1716)),de=n(1600),le=n(1513),ue=function(e){var t=e.consignmentId,n=e.shippingOption,a=Object(s.useCallback)((function(){return r.a.createElement("div",{className:"shippingOptionLabel"},r.a.createElement(le.a,{displayAdditionalInformation:!0,method:n}))}),[n]);return r.a.createElement(ce.a,{htmlId:"shippingOptionRadio-"+t+"-"+n.id,label:a,value:n.id})},pe=Object(s.memo)((function(e){var t=e.consignmentId,n=e.inputName,a=e.isLoading,i=e.shippingOptions,o=void 0===i?u.a:i,c=e.selectedShippingOptionId,d=e.onSelectedOption,l=Object(s.useCallback)((function(e){d(t,e)}),[t,d]);return o.length?r.a.createElement(p.a,{isLoading:a},r.a.createElement(de.b,{"aria-live":"polite",defaultSelectedItemId:c,name:n,onSelect:l},o.map((function(e){return r.a.createElement(ue,{consignmentId:t,key:e.id,shippingOption:e})})))):null})),me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectDefaultShippingOptions=function(e){var n=e.data;return Object(a.__awaiter)(t,void 0,void 0,(function(){var e,t,i,s,r,o,c,d,l;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return e=this.props,t=e.selectShippingOption,i=e.setFieldValue,(s=(n.getConsignments()||[]).find((function(e){var t=e.selectedShippingOption,n=e.availableShippingOptions;return!t&&n})))&&s.availableShippingOptions?(r=s.availableShippingOptions,o=s.id,c=function(e){if(e)return e.find((function(e){return e.isRecommended}))}(r),d=1===r.length&&r[0],(l=c||d)?[4,t(o,l.id)]:[2]):[2];case 1:return a.sent(),i("shippingOptionIds."+o,l.id),[2]}}))}))},t}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.props.subscribeToConsignments;this.unsubscribe=e(this.selectDefaultShippingOptions)},t.prototype.componentWillUnmount=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=void 0)},t.prototype.render=function(){var e=this,t=this.props,n=t.consignments,a=t.isMultiShippingMode,i=t.selectShippingOption,s=t.isLoading,o=t.shouldShowShippingOptions,c=(t.invalidShippingMessage,t.methodId);return n&&n.length&&o?r.a.createElement(r.a.Fragment,null,n.map((function(t){return r.a.createElement("div",{className:"shippingOptions-container form-fieldset",key:t.id},a&&e.renderConsignment(t),r.a.createElement(pe,{consignmentId:t.id,inputName:(n=t.id,"shippingOptionIds."+n),isLoading:s(t.id),onSelectedOption:i,selectedShippingOptionId:t.selectedShippingOption&&t.selectedShippingOption.id,shippingOptions:t.availableShippingOptions}),(!t.availableShippingOptions||!t.availableShippingOptions.length)&&!1);var n}))):r.a.createElement(p.a,{isLoading:s()},this.renderNoShippingOptions(r.a.createElement(A.a,{id:c||a?"shipping.select_shipping_address_text":"shipping.enter_shipping_address_text"})))},t.prototype.renderNoShippingOptions=function(e){return r.a.createElement("div",{className:"shippingOptions-panel optimizedCheckout-overlay"},r.a.createElement("p",{className:"shippingOptions-panel-message optimizedCheckout-primaryContent"},e))},t.prototype.renderConsignment=function(e){var t=this.props.cart;return r.a.createElement("div",{className:"staticConsignment"},r.a.createElement("strong",null,r.a.createElement(A.a,{id:"shipping.shipping_address_heading"})),r.a.createElement(re.a,{address:e.shippingAddress}),r.a.createElement(oe.a,{cart:t,consignment:e}))},t}(s.PureComponent);var he=Object(O.withFormik)({handleSubmit:i.noop,mapPropsToValues:function(e){var t=e.consignments,n={};return(t||[]).forEach((function(e){n[e.id]=e.selectedShippingOption?e.selectedShippingOption.id:""})),{shippingOptionIds:n}}})(me),ge=Object(o.createSelector)((function(e){return e.checkoutService.subscribe}),(function(e){return function(t){return e(t,(function(e){return e.data.getConsignments()}))}})),fe=Object(o.createSelector)((function(e,t){return t.isUpdatingAddress}),(function(e){return e.statuses.isLoadingShippingOptions}),(function(e){return e.statuses.isSelectingShippingOption}),(function(e){return e.statuses.isUpdatingConsignment}),(function(e){return e.statuses.isCreatingConsignments}),(function(e,t,n,a,i){return function(s){return e||t()||n(s)||a(s)||i()}})),be=function(e,t){if(t.length<2)return t;var n=U(e,t),a=Object(i.uniq)(Object(i.map)(n,"consignment.id"));return Object(i.sortBy)(t,(function(e){return a.indexOf(e.id)}))};var ve=Object(l.a)((function(e,t){var n=e.checkoutService,a=e.checkoutState,i=a.data,s=i.getCart,r=i.getConsignments,o=i.getConfig,c=i.getCustomer,d=i.getCheckout,l=a.statuses.isSelectingShippingOption,u=c(),p=s(),m=o(),h=d();if(!(m&&h&&u&&p))return null;var g=be(p,r()||[]),f=C(h);return{cart:p,consignments:g,invalidShippingMessage:m.checkoutSettings.shippingQuoteFailedMessage,isLoading:fe(a,t),isSelectingShippingOption:l,methodId:f,selectShippingOption:n.selectConsignmentShippingOption,subscribeToConsignments:ge({checkoutService:n,checkoutState:a})}}))(he),Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.cartHasChanged,n=e.isMultiShippingMode,a=e.shouldShowShippingOptions,i=void 0===a||a,s=e.shouldDisableSubmit,o=e.isLoading,c=e.onContinueButton;return r.a.createElement(r.a.Fragment,null,r.a.createElement(X.a,{id:"checkout-shipping-options",legend:r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,null,r.a.createElement(A.a,{id:"shipping.shipping_method_label"})),t&&r.a.createElement(se.b,{type:se.a.Error},r.a.createElement("strong",null,r.a.createElement(A.a,{id:"shipping.cart_change_error"}))))},r.a.createElement(ve,{isMultiShippingMode:n,isUpdatingAddress:o,shouldShowShippingOptions:i})),r.a.createElement(ie,null),r.a.createElement("div",{className:"form-actions"},r.a.createElement(j.c,{disabled:s,id:"checkout-shipping-continue",isLoading:o,type:"submit",variant:j.b.Primary,onClick:c},r.a.createElement(A.a,{id:"common.continue_action"}))))},t}(s.PureComponent),Se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={items:[]},t.onContinueButton=function(e){},t.handleCloseErrorModal=function(){t.setState({createCustomerAddressError:void 0})},t.handleSaveAddress=function(e){return Object(a.__awaiter)(t,void 0,void 0,(function(){var t,n,i,s;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return t=this.props.createCustomerAddress,(n=this.state.itemAddingAddress)?(i=Object(c.a)(e),[4,this.handleSelectAddress(i,n.itemId,n.key)]):[2];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,t(i)];case 3:return a.sent(),[3,5];case 4:return s=a.sent(),this.setState({createCustomerAddressError:s}),[3,5];case 5:return this.setState({itemAddingAddress:void 0}),[2]}}))}))},t.handleUseNewAddress=function(e,n,a){var i=t.props,s=i.onUseNewAddress;i.shouldShowAddAddressInCheckout?t.setState({itemAddingAddress:{key:a,itemId:n}}):s(e,n)},t.handleCloseAddAddressForm=function(){t.setState({itemAddingAddress:void 0})},t.handleSelectAddress=function(e,n,i){return Object(a.__awaiter)(t,void 0,void 0,(function(){var t,s,r,o,c,d;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:if(t=this.props,s=t.assignItem,r=t.onUnhandledError,o=t.getFields,!Object(_.a)(e,o(e.countryCode)))return[2,r(new T)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,s({shippingAddress:e,lineItems:[{itemId:n,quantity:1}]})];case 2:return c=a.sent().data,this.syncItems(i,e,c),[3,4];case 3:return d=a.sent(),r(new z(d)),[3,4];case 4:return[2]}}))}))},t.shouldDisableSubmit=function(){var e=t.props,n=e.isLoading,a=e.consignments;return n||!Object(D.a)(a)},t.syncItems=function(e,n,i){var s=t.state.items,r=function(e,t,n){var i=t.updatedItemIndex,s=t.address,r=n.cart,o=n.consignments;if(!(i<0||i>=e.length)&&r){var c=r.lineItems.physicalItems.map((function(e){return e.id})),l=(o||[]).find((function(e){return Object(d.a)(e.shippingAddress,s)})),u=function(e,t,n){if(!t||!n)return;var a=t.lineItems.physicalItems.filter((function(t){var n=t.productId,a=t.variantId;return n===e.productId&&a===e.variantId})).map((function(e){return e.id}));return n.lineItemIds.find((function(e){return a.includes(e)}))}(e[i],r,l);return e.map((function(e,t){if(u&&!c.includes(e.id)||t===i){var n=null!=u?u:e.id;return Object(a.__assign)(Object(a.__assign)({},e),{id:n,consignment:L(o||[],n)})}return e}))}}(s,{updatedItemIndex:s.findIndex((function(t){return t.key===e})),address:n},{cart:i.getCart(),consignments:i.getConsignments()});r&&t.setState({items:r})},t}return Object(a.__extends)(t,e),t.getDerivedStateFromProps=function(e,t){var n=e.cart,a=e.consignments;return t&&t.items&&Object(b.a)(n)===t.items.length?null:{items:U(n,a)}},t.prototype.render=function(){var e=this,t=this.props,n=t.addresses,a=t.consignments,i=t.cart,o=t.isGuest,c=t.onSignIn,d=t.onCreateAccount,l=t.cartHasChanged,u=t.shouldShowOrderComments,p=t.isLoading,m=t.getFields,h=t.defaultCountryCode,g=t.countries,f=t.countriesWithAutocomplete,b=t.googleMapsApiKey,v=this.state,C=v.items,S=v.itemAddingAddress,O=v.createCustomerAddressError;return o?r.a.createElement("div",{className:"checkout-step-info"},r.a.createElement(A.a,{id:"shipping.multishipping_guest_intro"})," ",r.a.createElement("a",{"data-test":"shipping-sign-in-link",href:"#",onClick:Object(y.a)(c)},r.a.createElement(A.a,{id:"shipping.multishipping_guest_sign_in"}))," ",r.a.createElement(V.a,{id:"shipping.multishipping_guest_create",onClick:d})):r.a.createElement(s.Fragment,null,r.a.createElement(x.a,{error:O,message:r.a.createElement(r.a.Fragment,null,r.a.createElement(A.a,{id:"address.consignment_address_updated_text"})," ",r.a.createElement(A.a,{id:"customer.create_address_error"})),onClose:this.handleCloseErrorModal,shouldShowErrorCode:!1}),r.a.createElement(P,{countries:g,countriesWithAutocomplete:f,defaultCountryCode:h,getFields:m,googleMapsApiKey:b,isLoading:p,isOpen:!!S,onRequestClose:this.handleCloseAddAddressForm,onSaveAddress:this.handleSaveAddress}),r.a.createElement(k.a,null,r.a.createElement("ul",{className:"consignmentList"},C.map((function(t){return r.a.createElement("li",{key:t.key},r.a.createElement(q,{addresses:n,item:t,onSelectAddress:e.handleSelectAddress,onUseNewAddress:e.handleUseNewAddress}))}))),r.a.createElement(Ce,{cartHasChanged:l,isLoading:p,isMultiShippingMode:!0,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:u,shouldShowShippingOptions:!Object(R.a)(a,i.lineItems),onContinueButton:this.onContinueButton})))},t}(s.PureComponent),Oe=Object(S.a)(Object(O.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){return{orderComment:e.customerMessage}},enableReinitialize:!0})(Se)),_e=n(693),Ee=n(692),ye=n(204),Ae=n(91),je=n(1674),ke=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.initialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?i.noop:s,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?i.noop:s,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.containerId,a=t.formFields,i=t.methodId;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"widget address-widget widget--"+i,id:n,tabIndex:-1}),r.a.createElement(X.a,null,a.filter((function(e){return e.custom})).map((function(t){return r.a.createElement(je.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields"})}))))},t}(s.PureComponent),Ie=n(1701),we="shippingAddress",Ne=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setFieldValue=function(e,n){var a=t.props,i=a.formik.setFieldValue,s=a.formFields.filter((function(e){return e.custom})).map((function(e){return e.name})).includes(e)?"customFields."+e:e;i(we+"."+s,n)},t.handleChange=function(e,n){(0,t.props.onFieldChange)(e,n)},t.handleAutocompleteToggle=function(e){var n=e.isOpen,a=e.inputValue,i=t.props.onFieldChange;n||i("address1",a)},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.address,a=e.onAddressSelect,i=e.onUseNewAddress,s=(e.shouldShowSaveAddress,e.countries,e.countriesWithAutocomplete,e.formFields,e.isLoading),o=(e.googleMapsApiKey,e.formik.values.shippingAddress,t&&t.length>0);return r.a.createElement(X.a,{id:"checkoutShippingAddress"},o&&r.a.createElement(X.a,{id:"shippingAddresses"},r.a.createElement(p.a,{isLoading:s},r.a.createElement(B.a,{addresses:t,onSelectAddress:a,onUseNewAddress:i,selectedAddress:n}))),!1)},t}(s.Component),Fe=Object(Ie.a)(Ne),Me=(n(1715),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleFieldValueChange=function(e){return function(n){(0,t.props.onFieldChange)(e,n)}},t}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.initialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?i.noop:s,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.componentWillUnmount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.deinitialize,n=e.methodId,s=e.onUnhandledError,r=void 0===s?i.noop:s,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t({methodId:n})];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),r(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this,t=this.props,n=t.address,a=t.buttonId,i=t.formFields,s=t.isLoading,o=i.filter((function(e){return e.custom})),c=o.length>0;return r.a.createElement(p.a,{isLoading:s},r.a.createElement("div",{className:"stepHeader",style:{padding:0}},r.a.createElement("div",{className:"stepHeader-body subheader"},r.a.createElement(re.a,{address:n})),r.a.createElement("div",{className:"stepHeader-actions subheader"},r.a.createElement(j.c,{id:a,onClick:Object(y.a)(),size:j.a.Tiny,testId:"step-edit-button",variant:j.b.Secondary},r.a.createElement(A.a,{id:"common.edit_action"})))),c&&r.a.createElement(X.a,{id:"customFieldset"},o.map((function(t){return r.a.createElement(je.a,{field:t,key:t.id+"-"+t.name,onChange:e.handleFieldValueChange(t.name),parentFieldName:"shippingAddress.customFields"})}))))},t}(s.PureComponent)),Pe=Object(s.memo)((function(e){var t=e.methodId,n=e.formFields,o=e.countries,c=e.countriesWithAutocomplete,d=e.consignments,l=e.googleMapsApiKey,u=e.onAddressSelect,p=e.onFieldChange,m=e.onUseNewAddress,h=e.initialize,g=e.deinitialize,f=e.isLoading,b=e.shippingAddress,v=e.hasRequestedShippingOptions,C=e.addresses,S=e.shouldShowSaveAddress,O=e.onUnhandledError,_=void 0===O?i.noop:O,E=e.isShippingStepPending,y=Object(s.useContext)(ye.a).setSubmitted,A=Object(s.useCallback)(Object(Ae.memoizeOne)((function(e){return function(t){return h(Object(a.__assign)(Object(a.__assign)({},e),t))}})),[]);if(t){var j={};if("amazon"===t)return j={amazon:{container:"addressWidget",onError:_}},r.a.createElement(ke,{containerId:"addressWidget",deinitialize:g,formFields:n,initialize:A(j),methodId:t,onFieldChange:p});if("amazonpay"===t&&b){return j={amazonpay:{editAddressButtonId:"edit-ship-button"}},r.a.createElement(Me,{address:b,buttonId:"edit-ship-button",deinitialize:g,formFields:n,initialize:A(j),isLoading:E,methodId:t,onFieldChange:p})}}return r.a.createElement(Fe,{address:b,addresses:C,consignments:d,countries:o,countriesWithAutocomplete:c,formFields:n,googleMapsApiKey:l,isLoading:f,onAddressSelect:u,onFieldChange:function(e,t){v&&y(!0),p(e,t)},onUseNewAddress:m,shouldShowSaveAddress:S})})),xe=["address1","postalCode","countryCode","city","stateOrProvince","stateOrProvinceCode"],Ve=n(48),Te=1700,ze=function(e){function t(t){var n=e.call(this,t)||this;n.state={isResettingAddress:!1,isUpdatingShippingData:!1,hasRequestedShippingOptions:!1},n.shouldDisableSubmit=function(){var e=n.props,t=e.isLoading,a=e.consignments,i=e.isValid,s=n.state.isUpdatingShippingData;return!!i&&(t||s||!Object(D.a)(a))},n.handleFieldChange=function(e){return Object(a.__awaiter)(n,void 0,void 0,(function(){var t,n,i;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return t=this.props.setFieldValue,"countryCode"===e&&(t("shippingAddress.stateOrProvince",""),t("shippingAddress.stateOrProvinceCode","")),[4,new Promise((function(e){return setTimeout(e)}))];case 1:return a.sent(),n=xe.includes(e),i=this.state.hasRequestedShippingOptions,this.props.isValid?(this.updateAddressWithFormData(n||!i),[2]):[2]}}))}))},n.handleAddressSelect=function(e){return Object(a.__awaiter)(n,void 0,void 0,(function(){var t,n,s,r,o,c,d;return Object(a.__generator)(this,(function(l){switch(l.label){case 0:t=this.props,n=t.updateAddress,s=t.onUnhandledError,r=void 0===s?i.noop:s,o=t.values,c=t.setValues,Ve.storage.CCSelectShippingAddressId.setValue(e.id?e.id:""),Ve.storage.CCSelectedAddress.setValue(JSON.stringify(e)),this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,n(e)];case 2:return l.sent(),c(Object(a.__assign)(Object(a.__assign)({},o),{shippingAddress:Object(_e.a)(this.getFields(e.countryCode),e)})),[3,5];case 3:return d=l.sent(),r(d),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},n.onContinueButton=function(e){return Object(a.__awaiter)(n,void 0,void 0,(function(){var e,t,n,s,r,o,c;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return e=this.props,t=e.onSubmit,n=e.onUnhandledError,s=void 0===n?i.noop:n,o=Ve.storage.CCShippingMethod.getValue(),console.log("in continue, storage.CCShippingMethod value:"+Ve.storage.CCShippingMethod.getValue()),console.log("in continue, storage.CCSelectedAddress value:"+Ve.storage.CCSelectedAddress.getValue()),"OTS"!=o?[3,2]:(r=JSON.parse(Ve.storage.CCOTSAddress.getValue()),[4,this.handleAddressSelect(r)]);case 1:return a.sent(),[3,3];case 2:r=JSON.parse(Ve.storage.CCSelectedAddress.getValue()),a.label=3;case 3:c={billingSameAsShipping:!0,shippingAddress:Object(_e.a)(this.getFields(r.countryCode),r),orderComment:""};try{t(c)}catch(e){s(e)}return[2]}}))}))},n.onUseNewAddress=function(){return Object(a.__awaiter)(n,void 0,void 0,(function(){var e,t,n,s,r,o,c,d;return Object(a.__generator)(this,(function(l){switch(l.label){case 0:e=this.props,t=e.deleteConsignments,n=e.onUnhandledError,s=void 0===n?i.noop:n,r=e.setValues,o=e.values,this.setState({isResettingAddress:!0}),l.label=1;case 1:return l.trys.push([1,3,4,5]),[4,t()];case 2:return c=l.sent(),r(Object(a.__assign)(Object(a.__assign)({},o),{shippingAddress:Object(_e.a)(this.getFields(c&&c.countryCode),c)})),[3,5];case 3:return d=l.sent(),s(d),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))};var s=n.props.updateAddress;return n.debouncedUpdateAddress=Object(i.debounce)((function(e,t){return Object(a.__awaiter)(n,void 0,void 0,(function(){return Object(a.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,s(e,{params:{include:{"consignments.availableShippingOptions":t}}})];case 1:return n.sent(),t&&this.setState({hasRequestedShippingOptions:!0}),[3,3];case 2:return this.setState({isUpdatingShippingData:!1}),[7];case 3:return[2]}}))}))}),Te),n}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.cartHasChanged,a=e.isLoading,i=e.onUnhandledError,s=e.methodId,o=e.shouldShowSaveAddress,c=e.countries,d=e.countriesWithAutocomplete,l=e.googleMapsApiKey,u=e.shippingAddress,p=e.consignments,m=e.shouldShowOrderComments,h=e.initialize,g=e.isValid,f=e.deinitialize,b=e.values.shippingAddress,v=e.isShippingStepPending,C=this.state,S=C.isResettingAddress,O=C.isUpdatingShippingData,_=C.hasRequestedShippingOptions;return r.a.createElement(k.a,{autoComplete:"on"},r.a.createElement(X.a,null,r.a.createElement(Pe,{addresses:t,consignments:p,countries:c,countriesWithAutocomplete:d,deinitialize:f,formFields:this.getFields(b&&b.countryCode),googleMapsApiKey:l,hasRequestedShippingOptions:_,initialize:h,isLoading:S,isShippingStepPending:v,methodId:s,onAddressSelect:this.handleAddressSelect,onFieldChange:this.handleFieldChange,onUnhandledError:i,onUseNewAddress:this.onUseNewAddress,shippingAddress:u,shouldShowSaveAddress:o})),r.a.createElement(Ce,{cartHasChanged:n,isLoading:a||O,isMultiShippingMode:!1,shouldDisableSubmit:this.shouldDisableSubmit(),shouldShowOrderComments:m,shouldShowShippingOptions:g,onContinueButton:this.onContinueButton}))},t.prototype.updateAddressWithFormData=function(e){var t=this.props,n=t.shippingAddress,a=t.values.shippingAddress,i=a&&Object(c.a)(a);i&&!Object(d.a)(i,n)&&(this.setState({isUpdatingShippingData:!0}),this.debouncedUpdateAddress(i,e))},t.prototype.getFields=function(e){return(0,this.props.getFields)(e)},t.contextType=ye.a,t}(s.PureComponent),Le=Object(S.a)(Object(O.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.shippingAddress;return{billingSameAsShipping:e.isBillingSameAsShipping,orderComment:e.customerMessage,shippingAddress:Object(_e.a)(t(n&&n.countryCode),n)}},isInitialValid:function(e){var t=e.shippingAddress,n=e.getFields,a=e.language;return!!t&&Object(N.a)({language:a,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return e.methodId?Object(E.object)({shippingAddress:Object(E.lazy)((function(e){return Object(Ee.a)({translate:Object(N.b)(t),formFields:n(e&&e.countryCode)})}))}):Object(E.object)({shippingAddress:Object(E.lazy)((function(e){return Object(N.a)({language:t,formFields:n(e&&e.countryCode)})}))})},enableReinitialize:!1})(ze)),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.addresses,n=e.assignItem,a=e.cart,i=e.cartHasChanged,s=e.createCustomerAddress,o=e.consignments,c=e.countries,d=e.countriesWithAutocomplete,l=e.onCreateAccount,u=e.customerMessage,p=e.deinitialize,m=e.deleteConsignments,h=e.getFields,g=e.googleMapsApiKey,f=e.initialize,b=e.isBillingSameAsShipping,v=e.isGuest,C=e.isLoading,S=e.isMultiShippingMode,O=e.methodId,_=e.onMultiShippingSubmit,E=e.onSignIn,y=e.onSingleShippingSubmit,A=e.onUnhandledError,j=e.onUseNewAddress,k=e.shippingAddress,I=e.shouldShowOrderComments,w=e.shouldShowSaveAddress,N=e.shouldShowAddAddressInCheckout,F=e.signOut,M=e.updateAddress,P=e.isShippingStepPending;return S?r.a.createElement(Oe,{addresses:t,assignItem:n,cart:a,cartHasChanged:i,consignments:o,countries:c,countriesWithAutocomplete:d,createCustomerAddress:s,customerMessage:u,defaultCountryCode:null==k?void 0:k.countryCode,getFields:h,googleMapsApiKey:g,isGuest:v,isLoading:C,onCreateAccount:l,onSignIn:E,onSubmit:_,onUnhandledError:A,onUseNewAddress:j,shouldShowAddAddressInCheckout:N,shouldShowOrderComments:I}):r.a.createElement(Le,{addresses:t,cartHasChanged:i,consignments:o,countries:c,countriesWithAutocomplete:d,customerMessage:u,deinitialize:p,deleteConsignments:m,getFields:h,googleMapsApiKey:g,initialize:f,isBillingSameAsShipping:b,isLoading:C,isMultiShippingMode:S,isShippingStepPending:P,methodId:O,onSubmit:y,onUnhandledError:A,shippingAddress:k,shouldShowOrderComments:I,shouldShowSaveAddress:w,signOut:F,updateAddress:M})},t}(s.Component),De=Object(S.a)(Ue),Re=Object(s.memo)((function(e){var t=e.isMultiShippingMode,n=e.isGuest,a=e.onMultiShippingChange,i=e.shouldShowMultiShipping;return r.a.createElement("div",{className:"form-legend-container"},r.a.createElement(Q.a,{testId:"shipping-address-heading"},r.a.createElement(A.a,{id:t?n?"shipping.multishipping_address_heading_guest":"shipping.multishipping_address_heading":"shipping.shipping_address_heading"})),i&&r.a.createElement("a",{"data-test":"shipping-mode-toggle",href:"#",onClick:Object(y.a)(a)},r.a.createElement(A.a,{id:t?"shipping.ship_to_single":"shipping.ship_to_multi"})))})),Be=n(330),qe=function(e){function t(t){var n=e.call(this,t)||this;return n.handleMultiShippingModeSwitch=function(){return Object(a.__awaiter)(n,void 0,void 0,(function(){var e,t,n,s,r,o,c,d,l;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:if(e=this.props,t=e.consignments,n=e.isMultiShippingMode,s=e.onToggleMultiShipping,r=void 0===s?i.noop:s,o=e.onUnhandledError,c=void 0===o?i.noop:o,d=e.updateShippingAddress,!(n&&t.length>1))return[3,5];this.setState({isInitializing:!0}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,d(t[0].shippingAddress)];case 2:return a.sent(),[3,5];case 3:return l=a.sent(),c(l),[3,5];case 4:return this.setState({isInitializing:!1}),[7];case 5:return r(),[2]}}))}))},n.handleSingleShippingSubmit=function(e){var t=e.shippingAddress,i=e.orderComment;return Object(a.__awaiter)(n,void 0,void 0,(function(){var e,n,s,r,o,l,u,p,m,h,g,f,b,v,C;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,n=e.customerMessage,s=e.updateCheckout,r=e.updateShippingAddress,o=e.updateBillingAddress,l=e.navigateNextStep,u=e.onUnhandledError,p=e.shippingAddress,m=e.billingAddress,h=e.methodId,g=!1,f=t&&Object(c.a)(t),b=[],v=this.hasRemoteBilling(h),Object(d.a)(f,p)||b.push(r(f||{})),g&&f&&!Object(d.a)(f,m)&&!v&&b.push(o(f)),n!==i&&b.push(s({customerMessage:i})),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all(b)];case 2:return a.sent(),l(g),[3,4];case 3:return C=a.sent(),u(C),[3,4];case 4:return[2]}}))}))},n.hasRemoteBilling=function(e){return["amazonpay"].some((function(t){return t===e}))},n.handleUseNewAddress=function(e,t){return Object(a.__awaiter)(n,void 0,void 0,(function(){var n,i,s,r;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:n=this.props,i=n.unassignItem,s=n.onUnhandledError,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,i({shippingAddress:e,lineItems:[{quantity:1,itemId:t}]})];case 2:return a.sent(),location.href="/account.php?action=add_shipping_address&from=checkout",[3,4];case 3:return r=a.sent(),s(new f(r)),[3,4];case 4:return[2]}}))}))},n.handleMultiShippingSubmit=function(e){var t=e.orderComment;return Object(a.__awaiter)(n,void 0,void 0,(function(){var e,n,i,s,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,n=e.customerMessage,i=e.updateCheckout,s=e.navigateNextStep,r=e.onUnhandledError,a.label=1;case 1:return a.trys.push([1,4,,5]),n===t?[3,3]:[4,i({customerMessage:t})];case 2:a.sent(),a.label=3;case 3:return s(!1),[3,5];case 4:return o=a.sent(),r(o),[3,5];case 5:return[2]}}))}))},n.state={isInitializing:!0,ccAddress:[],myShippingAddress:t.shippingAddress},n}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,s,r,o,c,d,l;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.loadShippingAddressFields,n=e.loadShippingOptions,s=e.onReady,r=void 0===s?i.noop:s,o=e.onUnhandledError,c=void 0===o?i.noop:o,a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,Promise.all([t(),n()])];case 2:return a.sent(),(d=JSON.parse(Ve.storage.CCAddresses.getValue()))&&(this.setState({ccAddress:Be.values(d.addresses)}),this.props.customer.addresses=Be.values(d.addresses)),r(),[3,5];case 3:return l=a.sent(),c(l),[3,5];case 4:return this.setState({isInitializing:!1}),[7];case 5:return[2]}}))}))},t.prototype.componentWillReceiveProps=function(e){return Object(a.__awaiter)(this,void 0,void 0,(function(){return Object(a.__generator)(this,(function(t){return this.setState({myShippingAddress:e.shippingAddress}),[2]}))}))},t.prototype.render=function(){var e=this.props,t=e.isBillingSameAsShipping,n=e.isGuest,i=e.shouldShowMultiShipping,s=(e.customer,e.unassignItem,e.updateShippingAddress),o=e.initializeShippingMethod,c=e.deinitializeShippingMethod,d=e.isMultiShippingMode,l=(e.onToggleMultiShipping,e.shippingAddress,Object(a.__rest)(e,["isBillingSameAsShipping","isGuest","shouldShowMultiShipping","customer","unassignItem","updateShippingAddress","initializeShippingMethod","deinitializeShippingMethod","isMultiShippingMode","onToggleMultiShipping","shippingAddress"])),u=this.state,m=u.isInitializing,h=u.ccAddress,g=u.myShippingAddress;return r.a.createElement("div",{className:"checkout-form"},r.a.createElement(Re,{isGuest:n,isMultiShippingMode:d,onMultiShippingChange:this.handleMultiShippingModeSwitch,shouldShowMultiShipping:i}),r.a.createElement(p.a,{isLoading:m,unmountContentWhenLoading:!0},r.a.createElement(De,Object(a.__assign)({},l,{addresses:h,deinitialize:c,initialize:o,isBillingSameAsShipping:t,isGuest:n,isMultiShippingMode:d,onMultiShippingSubmit:this.handleMultiShippingSubmit,onSingleShippingSubmit:this.handleSingleShippingSubmit,onUseNewAddress:this.handleUseNewAddress,shouldShowSaveAddress:!n,updateAddress:s,shippingAddress:g}))))},t}(s.Component),We=Object(o.createSelector)((function(e){return e.checkoutService.deleteConsignment}),(function(e){return e.checkoutState.data.getConsignments()}),(function(e,t){return function(){return Object(a.__awaiter)(void 0,void 0,void 0,(function(){return Object(a.__generator)(this,(function(n){switch(n.label){case 0:return t&&t.length?[4,Promise.all(t.map((function(t){var n=t.id;return e(n)})))]:[2];case 1:return[2,n.sent()[0].data.getShippingAddress()]}}))}))}}));function Ke(e){var t=e.checkoutService,n=e.checkoutState,a=n.data,i=a.getCart,s=a.getCheckout,r=a.getConfig,o=a.getCustomer,c=a.getConsignments,d=a.getBillingAddress,l=a.getShippingAddressFields,p=a.getShippingCountries,m=n.statuses,h=m.isShippingStepPending,g=m.isSelectingShippingOption,f=m.isLoadingShippingOptions,v=m.isUpdatingConsignment,S=m.isCreatingConsignments,O=m.isCreatingCustomerAddress,_=m.isLoadingShippingCountries,E=m.isUpdatingBillingAddress,y=m.isUpdatingCheckout,A=s(),j=r(),k=c()||[],I=o(),w=i();if(!(A&&j&&I&&w))return null;var N=j.checkoutSettings,F=N.enableOrderComments,M=N.features,P=N.hasMultiShippingEnabled,x=N.googleMapsApiKey,V=C(A),T=Object(b.a)(w),z=f()||g()||v()||S()||E()||y()||O(),L=P&&!V&&T>1&&T<50,U=["US","CA","AU","NZ"];return M["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&U.push("GB"),{assignItem:t.assignItemsToAddress,billingAddress:d(),cart:w,consignments:k,countries:p()||u.a,countriesWithAutocomplete:U,customer:I,customerMessage:A.customerMessage,createCustomerAddress:t.createCustomerAddress,deinitializeShippingMethod:t.deinitializeShipping,deleteConsignments:We({checkoutService:t,checkoutState:n}),getFields:l,googleMapsApiKey:x,initializeShippingMethod:t.initializeShipping,isGuest:I.isGuest,isInitializing:_()||f(),isLoading:z,isShippingStepPending:h(),loadShippingAddressFields:t.loadShippingAddressFields,loadShippingOptions:t.loadShippingOptions,methodId:V,shouldShowMultiShipping:L,shouldShowAddAddressInCheckout:M["CHECKOUT-4726.add_address_in_multishipping_checkout"],shouldShowOrderComments:F,signOut:t.signOutCustomer,unassignItem:t.unassignItemsToAddress,updateBillingAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,updateShippingAddress:t.updateShippingAddress}}t.default=Object(l.a)(Ke)(qe)}}]);
//# sourceMappingURL=shipping-51567fcc.js.map