(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[5],{1546:function(e,t,n){"use strict";var a=n(1),r=n(40),o=n.n(r),s=n(0),i=n.n(s),l=n(450),c=n(448),d=Object(s.forwardRef)((function(e,t){var n=e.additionalClassName,r=e.label,s=e.id,d=Object(a.__rest)(e,["additionalClassName","label","id"]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.a,Object(a.__assign)({},d,{className:o()("form-checkbox","optimizedCheckout-form-checkbox",n),id:s,ref:t,type:"checkbox"})),i.a.createElement(c.a,{htmlFor:s},r))}));t.a=d},1548:function(e,t,n){"use strict";var a=n(1),r=n(40),o=n.n(r),s=n(0),i=n.n(s),l=n(450),c=n(448),d=Object(s.forwardRef)((function(e,t){var n=e.additionalClassName,r=e.label,s=e.value,d=e.checked,u=e.id,m=Object(a.__rest)(e,["additionalClassName","label","value","checked","id"]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.a,Object(a.__assign)({},m,{checked:d,className:o()("form-radio","optimizedCheckout-form-radio",n),id:u,ref:t,type:"radio",value:s})),i.a.createElement(c.a,{htmlFor:u},r))}));t.a=d},1556:function(e,t,n){},1557:function(e,t,n){"use strict";var a=n(1),r=n(40),o=n.n(r),s=n(0),i=n.n(s),l=Object(s.forwardRef)((function(e,t){var n=e.additionalClassName,r=e.testId,s=e.className,l=Object(a.__rest)(e,["additionalClassName","testId","className"]);return i.a.createElement("textarea",Object(a.__assign)({},l,{className:s||o()("form-input","optimizedCheckout-form-input",n),"data-test":r,ref:t}))}));t.a=l},1564:function(e,t,n){},1575:function(e,t,n){},1578:function(e,t,n){},1579:function(e,t,n){},1580:function(e,t,n){},1581:function(e,t,n){},1593:function(e,t,n){"use strict";var a=n(1),r=n(13),o=n(0),s=n.n(o),i=n(453),l=n(1546),c=n(452);t.a=Object(o.memo)((function(e){var t=e.additionalClassName,n=e.disabled,d=void 0!==n&&n,u=e.labelContent,m=e.onChange,p=e.name,h=e.id,g=Object(o.useCallback)((function(e){var t=e.field;return s.a.createElement(o.Fragment,null,s.a.createElement(l.a,Object(a.__assign)({},t,{checked:!!t.value,disabled:d,id:h||t.name,label:u})),s.a.createElement(c.a,{name:p,testId:Object(r.kebabCase)(p)+"-field-error-message"}))}),[d,h,u,p]);return s.a.createElement(i.a,{additionalClassName:t,name:p,onChange:m,render:g})}))},1594:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(460);function r(e){return Object(a.a)(e.lineItems.physicalItems.filter((function(e){return!e.addedByPromotion})))}},1603:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(13);function r(e){var t=[];return Object(a.forIn)(e,(function(e,n){var r;if(Object(a.isDate)(e)){var o=Object(a.padStart)((e.getMonth()+1).toString(),2,"0"),s=Object(a.padStart)(e.getDate().toString(),2,"0");r=e.getFullYear()+"-"+o+"-"+s}else r=e;t.push({fieldId:n,fieldValue:r})})),t}},1604:function(e,t,n){"use strict";var a=n(1),r=n(0),o=n.n(r),s=n(1567),i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shouldShow:!1},t.handleClick=function(e){t.state.shouldShow?t.handleClose(e.nativeEvent):t.handleOpen(e.nativeEvent)},t.handleOpen=function(){t.state.shouldShow||t.setState({shouldShow:!0},(function(){document.addEventListener("click",t.handleClose)}))},t.handleClose=function(){t.state.shouldShow&&t.setState({shouldShow:!1},(function(){document.removeEventListener("click",t.handleClose)}))},t}return Object(a.__extends)(t,e),t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleClose)},t.prototype.render=function(){var e=this,t=this.props,n=t.children,r=t.placement,i=t.dropdown,l=this.state.shouldShow;return o.a.createElement(s.Manager,null,o.a.createElement(s.Reference,null,(function(t){var a=t.ref;return o.a.createElement("div",{className:"dropdownTrigger",onClick:e.handleClick,ref:a},n)})),o.a.createElement(s.Popper,{modifiers:{hide:{enabled:!1},flip:{enabled:!1},preventOverflow:{enabled:!1}},placement:r},(function(e){var t=e.ref,n=e.style;return l?o.a.createElement("div",{className:"dropdownMenu",ref:t,style:Object(a.__assign)(Object(a.__assign)({},n),{width:"100%",zIndex:1})},i):null})))},t.defaultProps={placement:"bottom-start"},t}(r.Component);t.a=i},1656:function(e,t,n){"use strict";var a=n(1498),r=n(261),o=Object(a.a)(r.a,{displayNamePrefix:"withDate",pickProps:function(e,t){return"date"===t&&!!e}});t.a=o},1669:function(e,t,n){"use strict";var a=n(1),r=n(91),o=n(13),s=n(0),i=n.n(s),l=n(324),c=n(262),d=n(210),u=n(1532),m=n(1674),p=n(1593),h={address1:"addressLine1",address2:"addressLine2",postalCode:"postCode",stateOrProvince:"province",stateOrProvinceCode:"provinceCode"};function g(e){return""+(h[e]||e)}function f(e){return g(e)+"Input"}var b=function(){function e(e){var t=e.address_components,n=e.name;this._name=n,this._address=t}return e.prototype.getState=function(){return this._get("administrative_area_level_1","short_name")},e.prototype.getStreet=function(){return this._name},e.prototype.getStreet2=function(){return""},e.prototype.getCity=function(){return this._get("postal_town","long_name")||this._get("locality","long_name")||this._get("neighborhood","short_name")},e.prototype.getCountry=function(){return this._get("country","short_name")},e.prototype.getPostCode=function(){return this._get("postal_code","short_name")},e.prototype._get=function(e,t){var n=this._address&&this._address.find((function(t){return-1!==t.types.indexOf(e)}));return n?n[t]:""},e}(),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(a.__extends)(t,e),t.prototype.getState=function(){return this._get("administrative_area_level_2","long_name")},t.prototype.getStreet2=function(){return this._get("locality","long_name")},t}(b),C=function(){function e(){}return e.create=function(e){var t=new b(e);switch(t.getCountry()){case"GB":return new v(e)}return t},e}();var _=n(1506),O=n(448),y=n(1607),E=n.n(y),S=(n(1580),function(e){var t=e.children;return i.a.createElement("div",{className:"popover"},t)});n(1581);function j(e,t){var n=["popoverList-item"];return e===t&&n.push("is-active"),n.join(" ")}var A,k=Object(s.memo)((function(e){var t=e.highlightedIndex,n=void 0===t?-1:t,r=e.testId,o=e.getItemProps,s=void 0===o?function(e){return e}:o,l=e.menuProps,c=void 0===l?{}:l,d=e.items;return d&&d.length?i.a.createElement("ul",Object(a.__assign)({className:"popoverList","data-test":r},c),d.map((function(e,t){return i.a.createElement("li",Object(a.__assign)({className:j(n,t),"data-test":r&&r+"-item"},s({key:e.id,index:t,item:e}),{key:t}),e.content)}))):null})),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateReducer=function(e,n){var r=t.props.onChange;switch(n.type){case E.a.stateChangeTypes.blurInput:case E.a.stateChangeTypes.blurButton:case E.a.stateChangeTypes.mouseUp:case E.a.stateChangeTypes.touchEnd:return Object(a.__assign)(Object(a.__assign)({},n),{inputValue:e.inputValue});case E.a.stateChangeTypes.changeInput:return n.inputValue!==e.inputValue&&r&&r(n.inputValue||"",e.isOpen),n;case E.a.stateChangeTypes.keyDownEnter:default:return n}},t.handleStateChange=function(e){var n=e.isOpen,a=e.inputValue,r=t.props.onToggleOpen,s=void 0===r?o.noop:r;void 0!==n&&s({isOpen:n,inputValue:a||""})},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.inputProps,r=t.initialValue,s=t.initialHighlightedIndex,l=t.items,c=t.children,d=t.onSelect,u=t.listTestId;return i.a.createElement(E.a,{defaultHighlightedIndex:0,initialHighlightedIndex:s,initialInputValue:r,itemToString:this.itemToString,labelId:n&&n["aria-labelledby"]?n["aria-labelledby"]:null,onChange:d,onStateChange:this.handleStateChange,stateReducer:this.stateReducer},(function(t){var r=t.isOpen,s=t.getInputProps,d=t.getMenuProps,m=t.getItemProps,p=t.highlightedIndex;return i.a.createElement("div",null,i.a.createElement("input",Object(a.__assign)({},s(),n)),r&&!!l.length&&i.a.createElement(S,null,i.a.createElement(k,{getItemProps:m,highlightedIndex:Object(o.isNumber)(p)?p:-1,items:l.map((function(t){return e.toPopoverItem(t)})),menuProps:d(),testId:u}),c))}))},t.prototype.toPopoverItem=function(e){return Object(a.__assign)(Object(a.__assign)({},e),{content:this.highlightItem(e)})},t.prototype.highlightItem=function(e){if(!e.highlightedSlices||!e.highlightedSlices.length)return e.label;var t=0,n=0;return e.highlightedSlices.reduce((function(a,r,o){var l=e.label,c=r.offset,d=r.length,u=c-t;return u&&(a.push(i.a.createElement(s.Fragment,{key:n},l.substr(t,u))),n+=1),t=c+d,a.push(i.a.createElement("strong",{key:n},l.substr(c,d))),n+=1,o===(e.highlightedSlices||[]).length-1&&(a.push(i.a.createElement(s.Fragment,{key:n},l.substr(t))),n+=1),a}),[])},t.prototype.itemToString=function(e){return e&&e.value||""},t}(s.PureComponent),w=(n(1579),n(703)),I=function(){function e(){this._scriptLoader=Object(w.getScriptLoader)()}return e.prototype.loadMapsSdk=function(e){var t=this;return this._googleAutoComplete?this._googleAutoComplete:(this._googleAutoComplete=new Promise((function(n,a){var r=["language=en","key="+e,"libraries=places","callback=initAutoComplete"].join("&");window.initAutoComplete=function(){(function(e){var t=e;return Boolean(t.google&&t.google.maps&&t.google.maps.places)})(window)&&n(window.google.maps),a()},t._scriptLoader.loadScript("//maps.googleapis.com/maps/api/js?"+r).catch((function(e){throw t._googleAutoComplete=void 0,e}))})),this._googleAutoComplete)},e}();var x=function(){function e(e,t){void 0===t&&(A||(A=new I),t=A),this._apiKey=e,this._scriptLoader=t}return e.prototype.getAutocompleteService=function(){return this._autocompletePromise||(this._autocompletePromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(e){if(!e.places.AutocompleteService)throw new Error("`AutocompleteService` is undefined");return new e.places.AutocompleteService}))),this._autocompletePromise},e.prototype.getPlacesServices=function(){var e=document.createElement("div");return this._placesPromise||(this._placesPromise=this._scriptLoader.loadMapsSdk(this._apiKey).then((function(t){if(!t.places.PlacesService)throw new Error("`PlacesService` is undefined");return new t.places.PlacesService(e)}))),this._placesPromise},e}(),P=function(e){function t(t){var n=e.call(this,t)||this;return n.onSelect=function(e){var t=n.props,a=t.fields,r=t.onSelect,s=void 0===r?o.noop:r,i=t.nextElement;n.googleAutocompleteService.getPlacesServices().then((function(t){t.getDetails({placeId:e.id,fields:a||["address_components","name"]},(function(t){i&&i.focus(),s(t,e)}))}))},n.onChange=function(e){var t=n.props,a=t.isAutocompleteEnabled,r=t.onChange;if((void 0===r?o.noop:r)(e,!1),!a)return n.resetAutocomplete();n.setAutocomplete(e),n.setItems(e)},n.googleAutocompleteService=new x(t.apiKey),n.state={items:[],autoComplete:"off"},n}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.initialValue,n=e.onToggleOpen,r=void 0===n?o.noop:n,s=e.inputProps,l=void 0===s?{}:s,c=this.state,d=c.autoComplete,u=c.items;return i.a.createElement(N,{initialHighlightedIndex:0,initialValue:t,inputProps:Object(a.__assign)(Object(a.__assign)({},l),{autoComplete:d}),items:u,listTestId:"address-autocomplete-suggestions",onChange:this.onChange,onSelect:this.onSelect,onToggleOpen:r},i.a.createElement("div",{className:"co-googleAutocomplete-footer"}))},t.prototype.setItems=function(e){var t=this;if(e){var n=this.props,a=n.componentRestrictions,r=n.types;this.googleAutocompleteService.getAutocompleteService().then((function(n){n.getPlacePredictions({input:e,types:r||["geocode"],componentRestrictions:a},(function(e){return t.setState({items:t.toAutocompleteItems(e)})}))}))}else this.setState({items:[]})},t.prototype.resetAutocomplete=function(){this.setState({items:[],autoComplete:"off"})},t.prototype.setAutocomplete=function(e){this.setState(Object(a.__assign)(Object(a.__assign)({},this.state),{autoComplete:e&&e.length?"nope":"off"}))},t.prototype.toAutocompleteItems=function(e){return(e||[]).map((function(e){return{label:e.description,value:e.structured_formatting.main_text,highlightedSlices:e.matched_substrings,id:e.place_id}}))},t}(s.PureComponent),F=Object(s.memo)((function(e){var t=e.field,n=t.default,a=t.name,r=e.countryCode,o=e.supportedCountries,c=e.parentFieldName,d=e.nextElement,u=e.apiKey,m=e.onSelect,p=e.onChange,h=e.onToggleOpen,b=c?c+"."+a:a,v=Object(s.useMemo)((function(){return i.a.createElement(l.a,{id:"address.address_line_1_label"})}),[]),C=function(e){return g(e)+"Label"}(a),y=Object(s.useMemo)((function(){return{className:"form-input optimizedCheckout-form-input",id:f(a),"aria-labelledby":C,placeholder:n}}),[a,C,n]),E=Object(s.useCallback)((function(e){var t=e.field;return i.a.createElement(P,{apiKey:u,componentRestrictions:r?{country:r}:void 0,initialValue:t.value,inputProps:y,isAutocompleteEnabled:!!r&&o.indexOf(r)>-1,nextElement:d,onChange:p,onSelect:m,onToggleOpen:h})}),[u,r,y,d,p,m,h,o]);return i.a.createElement("div",{className:"dynamic-form-field dynamic-form-field--addressLineAutocomplete"},i.a.createElement(_.a,{input:E,label:i.a.createElement(O.a,{htmlFor:y.id,id:C},v),name:b}))})),T=(n(1578),{address1:"address.address_line_1_label",address2:"address.address_line_2_label",city:"address.city_label",company:"address.company_name_label",countryCode:"address.country_label",firstName:"address.first_name_label",lastName:"address.last_name_label",phone:"address.phone_number_label",postalCode:"address.postal_code_label",stateOrProvince:"address.state_label",stateOrProvinceCode:"address.state_label"}),M={address1:"address-line1",address2:"address-line2",city:"address-level2",company:"organization",countryCode:"country",firstName:"given-name",lastName:"family-name",phone:"tel",postalCode:"postal-code",stateOrProvince:"address-level1",stateOrProvinceCode:"address-level1"},V={countryCode:"address.select_country_action",stateOrProvince:"address.select_state_action",stateOrProvinceCode:"address.select_state_action"},L="address1",z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.containerRef=Object(s.createRef)(),t.handleDynamicFormFieldChange=Object(r.memoize)((function(e){return function(n){t.syncNonFormikValue(e,n)}})),t.handleAutocompleteChange=function(e,n){n||t.syncNonFormikValue(L,e)},t.handleAutocompleteSelect=function(e,n){var r=n.value,s=t.props,i=s.countries,l=s.setFieldValue,c=void 0===l?o.noop:l,d=s.onChange,u=void 0===d?o.noop:d,m=function(e,t){if(void 0===t&&(t=[]),!e||!e.address_components)return{};var n=C.create(e),r=n.getState(),o=n.getCountry(),s=t&&t.find((function(e){return o===e.code})),i=n.getStreet2();return Object(a.__assign)({address2:i,city:n.getCity(),countryCode:o,postalCode:n.getPostCode()},r?function(e,t){void 0===t&&(t=[]);var n=t.find((function(t){var n=t.code,a=t.name;return n===e||a===e}));if(!n)return{stateOrProvince:t.length?"":e,stateOrProvinceCode:""};return{stateOrProvince:n.name,stateOrProvinceCode:n.code}}(r,s&&s.subdivisions):{})}(e,i);Object(o.forIn)(m,(function(e,t){c(t,e),u(t,e)})),r&&t.syncNonFormikValue(L,r)},t.syncNonFormikValue=function(e,n){var a=t.props,r=a.formFields,s=a.setFieldValue,i=void 0===s?o.noop:s,l=a.onChange,c=void 0===l?o.noop:l,u=r.filter((function(e){return e.custom&&e.fieldType===d.a.date})).map((function(e){return e.name}));(e===L||u.indexOf(e)>-1)&&i(e,n),c(e,n)},t}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){var e=this.containerRef.current;e&&(this.nextElement=e.querySelector('[autocomplete="address-line2"]'))},t.prototype.render=function(){var e=this,t=this.props,n=t.formFields,a=t.fieldName,r=t.language,o=t.countriesWithAutocomplete,s=t.countryCode,c=t.googleMapsApiKey,d=t.onAutocompleteToggle,h=t.shouldShowSaveAddress;return i.a.createElement(i.a.Fragment,null,i.a.createElement(u.a,null,i.a.createElement("div",{className:"checkout-address",ref:this.containerRef},n.map((function(t){var n=t.name,u=V[n];return"address1"===n&&c&&o?i.a.createElement(F,{apiKey:c,countryCode:s,field:t,key:t.id,nextElement:e.nextElement||void 0,onChange:e.handleAutocompleteChange,onSelect:e.handleAutocompleteSelect,onToggleOpen:d,parentFieldName:a,supportedCountries:o}):i.a.createElement(m.a,{autocomplete:M[t.name],extraClass:"dynamic-form-field--"+g(n),field:t,inputId:f(n),key:t.id+"-"+t.name,label:t.custom?t.label:i.a.createElement(l.a,{id:T[t.name]}),onChange:e.handleDynamicFormFieldChange(n),parentFieldName:t.custom?a?a+".customFields":"customFields":a,placeholder:t.default?t.default:u&&r.translate(u)})})))),h&&i.a.createElement(p.a,{labelContent:i.a.createElement(l.a,{id:"address.save_in_addressbook"}),name:a?a+".shouldSaveAddress":"shouldSaveAddress"}))},t}(s.Component);t.a=Object(c.a)(z)},1674:function(e,t,n){"use strict";var a=n(1),r=n(0),o=n.n(r),s=n(324),i=n(114),l=n(13),c=n(210),d=n(1568),u=n.n(d),m=n(1656),p=n(1546),h=n(1548),g=n(1557),f=n(1502),b=Object(r.memo)(Object(m.a)((function(e){e.additionalClassName;var t=e.date,n=e.fieldType,s=e.id,i=e.name,d=e.onChange,m=void 0===d?l.noop:d,b=e.options,v=e.placeholder,C=e.value,_=Object(a.__rest)(e,["additionalClassName","date","fieldType","id","name","onChange","options","placeholder","value"]),O=t.inputFormat,y=Object(r.useCallback)((function(e,t){return m(Object(a.__assign)(Object(a.__assign)({},t),{target:{name:i,value:e}}))}),[m,i]);switch(n){case c.a.dropdown:return o.a.createElement("select",Object(a.__assign)({},_,{className:"form-select optimizedCheckout-form-select","data-test":s+"-select",id:s,name:i,onChange:m,value:null===C?"":C}),v&&o.a.createElement("option",{value:""},v),b&&b.map((function(e){var t=e.label,n=e.value;return o.a.createElement("option",{key:n,value:n},t)})));case c.a.radio:return b&&b.length?o.a.createElement(o.a.Fragment,null,b.map((function(e){var t=e.label,n=e.value;return o.a.createElement(h.a,Object(a.__assign)({},_,{checked:n===C,id:s+"-"+n,key:n,label:t,name:i,onChange:m,testId:s+"-"+n+"-radio",value:n}))}))):null;case c.a.checkbox:return b&&b.length?o.a.createElement(o.a.Fragment,null,b.map((function(e){var t=e.label,n=e.value;return o.a.createElement(p.a,Object(a.__assign)({},_,{checked:!!Array.isArray(C)&&C.includes(n),id:s+"-"+n,key:n,label:t,name:i,onChange:m,testId:s+"-"+n+"-checkbox",value:n}))}))):null;case c.a.date:return o.a.createElement(u.a,Object(a.__assign)({},_,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:"form-input optimizedCheckout-form-input",dateFormat:O,maxDate:_.max?new Date(_.max+"T00:00:00Z"):void 0,minDate:_.min?new Date(_.min+"T00:00:00Z"):void 0,name:i,onChange:y,placeholderText:O.toUpperCase(),popperClassName:"optimizedCheckout-contentPrimary",selected:Object(l.isDate)(C)?C:void 0}));case c.a.multiline:return o.a.createElement(g.a,Object(a.__assign)({},_,{id:s,name:i,onChange:m,testId:s+"-text",type:n,value:C}));default:return o.a.createElement(f.a,Object(a.__assign)({},_,{id:s,name:i,onChange:m,placeholder:v,testId:s+"-"+(n===c.a.password?"password":"text"),type:n,value:C}))}}))),v=n(457),C=n(452),_=(n(1564),Object(r.memo)((function(e){var t=e.testId,n=e.onSelectedAll,a=e.onSelectedNone,i=Object(r.useCallback)((function(e){e.preventDefault(),n()}),[n]),l=Object(r.useCallback)((function(e){e.preventDefault(),a()}),[a]);return o.a.createElement("ul",{className:"multiCheckbox--controls"},o.a.createElement("li",{className:"multiCheckbox--control"},o.a.createElement(s.a,{id:"address.select"})),o.a.createElement("li",{className:"multiCheckbox--control"},o.a.createElement("a",{"data-test":t+"Checkbox-all-button",href:"#",onClick:i},o.a.createElement(s.a,{id:"address.select_all"}))),o.a.createElement("li",{className:"multiCheckbox--control"},o.a.createElement("a",{"data-test":t+"Checkbox-none-button",href:"#",onClick:l},o.a.createElement(s.a,{id:"address.select_none"}))))}))),O=function(e){var t=e.form,n=t.values,a=t.errors,s=e.id,d=e.label,u=e.name,m=e.onChange,p=void 0===m?l.noop:m,h=e.options,g=e.push,f=e.remove,O=Object(r.useCallback)((function(){var e=Object(i.getIn)(n,u)||[];Object(l.difference)(h.map((function(e){return e.value})),e).forEach((function(e){return g(e)})),p(Object(i.getIn)(n,u))}),[u,p,h,g,n]),y=Object(r.useCallback)((function(){(Object(i.getIn)(n,u)||[]).forEach((function(){return f(0)})),p(Object(i.getIn)(n,u))}),[u,p,f,n]),E=Object(r.useCallback)((function(e){var t=Object(i.getIn)(n,u)||[],a=e.target,r=a.value;a.checked?g(r):f(t.indexOf(r)),p(Object(i.getIn)(n,u))}),[u,p,g,f,n]);return o.a.createElement(v.a,{hasError:Object(i.getIn)(a,u)&&Object(i.getIn)(a,u).length},d,h.length>1&&o.a.createElement(_,{onSelectedAll:O,onSelectedNone:y,testId:s}),o.a.createElement(b,{fieldType:c.a.checkbox,id:s,name:u,onChange:E,options:h,value:Object(i.getIn)(n,u)||[]}),o.a.createElement(C.a,{name:u,testId:Object(l.kebabCase)(u)+"-field-error-message"}))},y=Object(r.memo)((function(e){var t=e.id,n=e.label,s=e.name,c=e.onChange,d=e.options,u=Object(r.useCallback)((function(e){return o.a.createElement(O,Object(a.__assign)({id:t,label:n,name:s,onChange:c,options:d},Object(l.pick)(e,["form","pop","push","remove"])))}),[t,n,s,c,d]);return o.a.createElement(i.FieldArray,{name:s,render:u})})),E=n(1506),S=n(448);t.a=Object(r.memo)((function(e){var t=e.field,n=t.fieldType,i=t.type,l=t.secret,d=t.name,u=t.label,m=t.required,p=t.options,h=t.max,g=t.min,f=t.maxLength,v=e.parentFieldName,C=e.onChange,_=e.placeholder,O=e.inputId,j=e.autocomplete,A=e.label,k=e.extraClass,N=O||d,w=v?v+"."+d:d,I=Object(r.useMemo)((function(){return o.a.createElement(S.a,{htmlFor:N},A||u,!m&&o.a.createElement(o.a.Fragment,null," ",o.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},o.a.createElement(s.a,{id:"common.optional_text"}))))}),[N,u,m,A]),x=Object(r.useMemo)((function(){return"text"===n?"integer"===i?c.a.number:l?c.a.password:c.a.text:n}),[n,i,l]),P=Object(r.useCallback)((function(e){var t=e.field;return o.a.createElement(b,Object(a.__assign)({},t,{autoComplete:j,fieldType:x,id:N,max:h,maxLength:f||void 0,min:g,options:p&&p.items,placeholder:_||p&&p.helperLabel,rows:p&&p.rows}))}),[N,h,f,g,p,_,x,j]);return o.a.createElement("div",{className:"dynamic-form-field "+k},n===c.a.checkbox?o.a.createElement(y,{id:N,label:I,name:w,onChange:C,options:p&&p.items||[]}):o.a.createElement(E.a,{input:P,label:I,name:w,onChange:C}))}))},1686:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(1),r=n(1603);function o(e){var t=e.customFields,n=Object(a.__rest)(e,["customFields"]),o=e.shouldSaveAddress;return Object(a.__assign)(Object(a.__assign)({},n),{shouldSaveAddress:o,customFields:Object(r.a)(t)})}},1696:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(695),r=n(1531);function o(e){return(e&&e.payments?e.payments:[]).find((function(e){return!Object(a.a)(e)&&!Object(r.a)(e)&&!!e.providerId}))}},1717:function(e,t,n){"use strict";var a=n(1),r=n(0),o=n.n(r),s=n(1496),i=n(324),l=n(1604),c=n(1548),d=n(1534),u=n(1532),m=n(448),p=n(1502),h=n(459),g=(n(1575),n(708)),f=n(13),b=(n(1556),n(262)),v=Object(b.a)((function(e){var t=e.onChange,n=e.language,a=Object(r.createRef)(),s=Object(f.debounce)((function(e){t&&t(e)}),200);return Object(r.useEffect)((function(){var e=a.current;return e&&(e.onclick=function(e){e.stopPropagation()}),function(){}})),o.a.createElement("div",{className:"cc-address-search-container",ref:a},o.a.createElement(p.a,{placeholder:n.translate("shipping.searchAddress_label"),onChange:function(e){s(e.target.value)}}))})),C=n(48),_={address1:"",address2:"",city:"",company:"",country:"USA",countryCode:"US",customFields:[],firstName:"",id:"",lastName:"",phone:"",postalCode:"",stateOrProvince:"",stateOrProvinceCode:"",type:"residential"},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shippingAddressMethod:C.storage.CCShippingMethod.getValue()?C.storage.CCShippingMethod.getValue():"buildIn",OTSAddress:C.storage.CCOTSAddress.getValue()?JSON.parse(C.storage.CCOTSAddress.getValue()):_},t.handleShippingAddressMethodChange=function(e){C.storage.CCShippingMethod.setValue(e.target.value),t.setState({shippingAddressMethod:e.target.value}),console.log("after set, storage.CCShippingMethod value:"+C.storage.CCShippingMethod.getValue())},t.handleSelectAddress=function(e){var n=t.props,a=n.onSelectAddress,r=n.selectedAddress;Object(h.a)(r,e)||a(e)},t.handleUseNewAddress=function(){var e=t.props,n=e.selectedAddress;(0,e.onUseNewAddress)(n)},t.handleFieldValueChange=function(e){return function(n){t.state.OTSAddress[e]=n.target.value,"stateOrProvince"==e&&(t.state.OTSAddress.stateOrProvinceCode=n.target.value),"firstName"==e&&(t.state.OTSAddress.lastName=n.target.value),t.setState({OTSAddress:Object(a.__assign)({},t.state.OTSAddress)}),C.storage.CCOTSAddress.setValue(JSON.stringify(t.state.OTSAddress))}},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.addresses,a=t.selectedAddress,r=this.state,s=r.shippingAddressMethod,h=r.OTSAddress,g=C.storage.CCAllowOTS.getValue();console.log("allowOTS:"+g);var f=a&&a.customFields&&0==a.customFields.length;return o.a.createElement("div",{className:"form-field"},o.a.createElement(c.a,{checked:"buildIn"==s,id:"addr-methohd-default",key:"buildIn",label:"Choose from the address book:",name:"shippingAddressMethod",onChange:this.handleShippingAddressMethodChange,value:"buildIn"}),"buildIn"==s?o.a.createElement("div",{className:"dropdown--select",role:"combobox"},o.a.createElement(l.a,{dropdown:o.a.createElement(y,{addresses:n,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:f?void 0:a})},o.a.createElement(E,{addresses:n,selectedAddress:a}))):"","true"==g?o.a.createElement(c.a,{checked:"OTS"==s,id:"addr-method-ots",key:"OTS",label:"Specify a one-time shipping address (US only):",name:"shippingAddressMethod",onChange:this.handleShippingAddressMethodChange,value:"OTS"}):"","true"==g&&"OTS"==s?o.a.createElement(d.a,{className:"checkout-form",id:"checkout-customer-returning",testId:"checkout-customer-returning"},o.a.createElement(u.a,null,o.a.createElement("div",{className:"create-account-form"},[{id:"firstName",name:"firstName",custom:!1,label:"Contact Name",required:!0},{id:"company",name:"company",custom:!1,label:"Company Name",required:!0},{id:"address1",name:"address1",custom:!1,label:"Address Line 1",required:!0},{id:"address2",name:"address2",custom:!1,label:"Address Line 2",required:!1},{id:"city",name:"city",custom:!1,label:"City",required:!0},{id:"stateOrProvince",name:"stateOrProvince",custom:!1,label:"State",required:!0},{id:"postalCode",name:"postalCode",custom:!1,label:"Zip Code",required:!0},{id:"phone",name:"phone",custom:!1,label:"Phone Number",required:!1}].map((function(t){return o.a.createElement("div",{className:"dynamic-form-field"},o.a.createElement("div",{className:"form-field"},o.a.createElement(m.a,{htmlFor:t.id},t.label,t.required?o.a.createElement(o.a.Fragment,null," ",o.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},"(Required)")):o.a.createElement(o.a.Fragment,null," ",o.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},o.a.createElement(i.a,{id:"common.optional_text"})))),o.a.createElement(p.a,{id:t.id,name:t.name,onChange:e.handleFieldValueChange(t.name),value:h[t.name]})))}))))):"")},t}(r.PureComponent),y=function(e){var t=e.addresses,n=e.onSelectAddress,a=Object(r.useState)(t),i=a[0],l=a[1];return o.a.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},o.a.createElement(v,{onChange:function(e){l(function(e,t){return t.filter((function(t){return JSON.stringify(t).trim().toLocaleLowerCase().includes(e.trim().toLocaleLowerCase())}))}(e,t))}}),i.map((function(e){return o.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select",key:e.id},o.a.createElement("a",{href:"#",onClick:Object(s.a)((function(){return n(e)}))},o.a.createElement(g.a,{address:e})))})))},E=function(e){var t=e.selectedAddress;return o.a.createElement("a",{className:"button dropdown-button dropdown-toggle--select",href:"#",id:"addressToggle",onClick:Object(s.a)()},t?o.a.createElement(g.a,{address:t}):o.a.createElement(i.a,{id:"address.enter_address_action"}))};t.a=Object(r.memo)(O)},1728:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(13),o=n(0),s=n.n(o),i=n(1686),l=n(459),c=n(446),d=n(1499),u=n(324),m=n(1594),p=n(1533),h=n(1525),g=n(1696);function f(e){var t=Object(g.a)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var b=n(114),v=n(70),C=n(1717),_=(n(1669),n(693)),O=n(683),y=n(692),E=n(262),S=n(448),j=n(1502),A=n(1532),k=n(1506),N=function(){var e=Object(o.useCallback)((function(e){return s.a.createElement(S.a,{hidden:!0,htmlFor:e},s.a.createElement(u.a,{id:"shipping.order_comment_label"}))}),[]),t=Object(o.useCallback)((function(e){var t=e.field;return s.a.createElement(j.a,Object(a.__assign)({},t,{autoComplete:"off",maxLength:2e3}))}),[]),n=Object(o.useMemo)((function(){return s.a.createElement(p.a,null,s.a.createElement(u.a,{id:"shipping.order_comment_label"}))}),[]);return s.a.createElement(A.a,{legend:n,testId:"checkout-shipping-comments"},s.a.createElement(k.a,{input:t,label:e,name:"orderComment"}))},w=n(1524),I=n(1534),x=n(1511),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isResettingAddress:!1},t.addressFormRef=Object(o.createRef)(),t.handleSelectAddress=function(e){return Object(a.__awaiter)(t,void 0,void 0,(function(){var t,n,r,o;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:t=this.props,n=t.updateAddress,r=t.onUnhandledError,this.setState({isResettingAddress:!0}),a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,n(e)];case 2:return a.sent(),[3,5];case 3:return o=a.sent(),r(o),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},t.handleUseNewAddress=function(){t.handleSelectAddress({})},t}return Object(a.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=(e.googleMapsApiKey,e.billingAddress),n=(e.countriesWithAutocomplete,e.customer),a=n.addresses,r=(n.isGuest,e.getFields),o=(e.countries,e.isUpdating),i=(e.setFieldValue,e.shouldShowOrderComments),l=e.values,c="amazonpay"===e.methodId,d=r(l.countryCode),m=d.filter((function(e){return e.custom})),p=(m.length,this.state.isResettingAddress),g=a&&a.length>0;return s.a.createElement(I.a,{autoComplete:"on"},c&&t&&s.a.createElement("div",{className:"form-fieldset"},s.a.createElement(x.a,{address:t})),s.a.createElement(A.a,{id:"checkoutBillingAddress",ref:this.addressFormRef},g&&!c&&s.a.createElement(A.a,{id:"billingAddresses"},s.a.createElement(h.a,{isLoading:p},s.a.createElement(C.a,{addresses:a,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:t}))),!1),i&&s.a.createElement(N,null),s.a.createElement("div",{className:"form-actions"},s.a.createElement(w.c,{disabled:o||p,id:"checkout-billing-continue",isLoading:o||p,type:"submit",variant:w.b.Primary},s.a.createElement(u.a,{id:"common.continue_action"}))))},t}(o.PureComponent),F=Object(E.a)(Object(b.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.customerMessage,r=e.billingAddress;return Object(a.__assign)(Object(a.__assign)({},Object(_.a)(t(r&&r.countryCode),r)),{orderComment:n})},isInitialValid:function(e){var t=e.billingAddress,n=e.getFields,a=e.language;return!!t&&Object(O.a)({language:a,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return"amazonpay"===e.methodId?Object(v.lazy)((function(e){return Object(y.a)({translate:Object(O.b)(t),formFields:n(e&&e.countryCode)})})):Object(v.lazy)((function(e){return Object(O.a)({language:t,formFields:n(e&&e.countryCode)})}))},enableReinitialize:!0})(P)),T=n(48),M=function(e){function t(t){var n=e.call(this,t)||this;n.handleSubmit=function(e){return Object(a.__awaiter)(n,void 0,void 0,(function(){var t,n,r,o,s,c,d,u,m,p,h=e.orderComment,g=Object(a.__rest)(e,["orderComment"]);return Object(a.__generator)(this,(function(e){switch(e.label){case 0:t=this.props,n=t.updateAddress,r=t.updateCheckout,o=t.customerMessage,s=t.billingAddress,c=t.navigateNextStep,d=t.onUnhandledError,u=[],(m=Object(i.a)(g))&&!Object(l.a)(m,s)&&u.push(n(m)),o!==h&&u.push(r({customerMessage:h})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(u)];case 2:return e.sent(),c(),[3,4];case 3:return p=e.sent(),d(p),[3,4];case 4:return[2]}}))}))};var r=JSON.parse(T.storage.CCAddresses.getValue());return n.state={billingAddress:r.billAddresses},n}return Object(a.__extends)(t,e),t.prototype.componentDidMount=function(){return Object(a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,o,s,i,l,c;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.initialize,n=e.onReady,o=void 0===n?r.noop:n,s=e.onUnhandledError,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,t()];case 2:a.sent(),(i=JSON.parse(T.storage.CCAddresses.getValue()))&&this.props.customer&&(this.props.customer.addresses=[i.billAddresses]),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,this.props.updateAddress(i.billAddresses)];case 4:return a.sent(),[3,6];case 5:return l=a.sent(),s(l),[3,6];case 6:return o(),[3,8];case 7:return c=a.sent(),s(c),[3,8];case 8:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,n=e.isInitializing,r=Object(a.__rest)(e,["updateAddress","isInitializing"]),o=this.state.billingAddress;return s.a.createElement("div",{className:"checkout-form"},s.a.createElement("div",{className:"form-legend-container"},s.a.createElement(p.a,{testId:"billing-address-heading"},s.a.createElement(u.a,{id:"billing.billing_address_heading"}))),s.a.createElement(h.a,{isLoading:n,unmountContentWhenLoading:!0},s.a.createElement(F,Object(a.__assign)({},r,{onSubmit:this.handleSubmit,updateAddress:t,billingAddress:o}))))},t}(o.Component);t.default=Object(c.a)((function(e){var t=e.checkoutService,n=e.checkoutState,a=n.data,r=a.getCheckout,o=a.getConfig,s=a.getCart,i=a.getCustomer,l=a.getBillingAddress,c=a.getBillingAddressFields,u=a.getBillingCountries,p=n.statuses,h=p.isLoadingBillingCountries,g=p.isUpdatingBillingAddress,b=p.isUpdatingCheckout,v=o(),C=i(),_=r(),O=s();if(!(v&&C&&_&&O))return null;var y=v.checkoutSettings,E=y.enableOrderComments,S=y.googleMapsApiKey,j=["US","CA","AU","NZ"];return y.features["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&j.push("GB"),{billingAddress:l(),countries:u()||d.a,countriesWithAutocomplete:j,customer:C,customerMessage:_.customerMessage,getFields:c,googleMapsApiKey:S,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:g()||b(),methodId:f(_),shouldShowOrderComments:E&&Object(m.a)(O)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout}}))(M)}}]);
//# sourceMappingURL=billing-5b8a013f.js.map